/**
 * isbx-loopback-cms - v0.1.3 - 2017-12-22
 * 
 *
 * Copyright (c) 2017 ISBX
 * Licensed MIT <>
 */

angular.module("dashboard",["dashboard.Dashboard","dashboard.Login","dashboard.Register","dashboard.directives","dashboard.filters","dashboard.services.Cache","dashboard.services.Session","templates-app","templates-common","ui.router","oc.lazyLoad","ngCookies","ngAnimate","pascalprecht.translate"]).config(["$locationProvider","$stateProvider","$urlRouterProvider","$compileProvider","$qProvider","$translateProvider","Config",function(a,b,c,d,e,f,g){"ngInject";d.aHrefSanitizationWhitelist(/^\s*(http|https|ftp|mailto|tel|file|blob|data):/),c.otherwise("/login"),g.serverParams.disableRegistration&&c.when("/register","/login"),a.html5Mode(!0),f.useSanitizeValueStrategy("escape"),g.serverParams.translateUrl&&f.useUrlLoader(g.serverParams.translateUrl),g.serverParams.defaultLanguage&&f.fallbackLanguage(g.serverParams.defaultLanguage),b.state("public",{abstract:!0,template:"<ui-view />"}).state("public.accessDenied",{url:"/access-denied",template:'<div class="no-script-warning"><h1>Access Denied</h1><p>You are not authorized to access this page.</p><p><button onclick="window.history.go(-2)">Back</button></p></div>',data:{pageTitle:"Access Denied"}}),c.deferIntercept()}]).run(["$ocLazyLoad","$rootScope","$urlRouter","$injector","$translate","Config",function(a,b,c,d,e,f){"ngInject";f.serverParams.defaultLanguage&&e.use(f.serverParams.defaultLanguage),f.serverParams.translateUrl&&e.refresh();var g=!1;f.serverParams.customModules?a.load(f.serverParams.customModules).then(function(){g=!0,b.$broadcast("modulesLoaded"),Array.isArray(f.serverParams.injectOnStart)&&f.serverParams.injectOnStart.forEach(d.get)},function(a){console.log(a)}):g=!0,b.$on("$locationChangeSuccess",function(a){if(g)c.sync();else var d=b.$on("modulesLoaded",function(){c.sync(),d()})})}]).constant("constants",{TIMEOUT_INTERVAL:5e3,PUBLIC_STATE:"public",LOGIN_STATE:"public.login"}).controller("AppCtrl",["$scope","$location","$state","$rootScope","$timeout","$document","$cookies","SessionService","CacheService","Config","constants",function(a,b,c,d,e,f,g,h,i,j,k){"ngInject";d.$state=c,j.serverParams.gaTrackingId&&ga("create",j.serverParams.gaTrackingId,"auto"),d.$on("$stateChangeStart",function(a,b,d,e,f){var g=b.name;if(g=g.substr(g,g.indexOf(".")),!h.getAuthToken()&&g!=k.PUBLIC_STATE){var l={state:b,params:d};return i.set("desiredState",l),j.serverParams.loginState?c.go(j.serverParams.loginState):g!=k.PUBLIC_STATE&&c.go(k.LOGIN_STATE),void a.preventDefault()}h.isAuthorized(b,d)||(c.go("public.accessDenied"),a.preventDefault())}),a.$on("$stateChangeSuccess",function(b,c,d,e,f){angular.isDefined(c.data.pageTitle)&&(a.pageTitle=c.data.pageTitle)}),d.logOut=function(){h.getAuthToken()&&(i.reset(),h.logOut().then(function(a){j.serverParams.loginState?c.go(j.serverParams.loginState):c.go(k.LOGIN_STATE)}).catch(function(a){c.go(k.LOGIN_STATE)}))};var l=new Date;d.persistSession=function(){e.cancel(d.persistId),c.current.name.indexOf(k.PUBLIC_STATE)>-1||(l=new Date,new Date-l>k.TIMEOUT_INTERVAL?d.checkTimeout()&&g.put("lastActive",new Date):d.persistId=e(function(){d.checkTimeout()&&g.put("lastActive",new Date)},k.TIMEOUT_INTERVAL))},d.checkTimeout=function(){if(e.cancel(d.timeoutId),!g.get("lastActive"))return console.error("Session Timedout on another window/tab"),c.go(k.LOGIN_STATE),!1;var a=new Date(g.get("lastActive"));return new Date-a>j.serverParams.sessionTimeout?(d.logOut(),!1):(d.timeoutId=e(d.checkTimeout,k.TIMEOUT_INTERVAL),!0)},j.serverParams.sessionTimeout&&"localhost"!=b.host()&&(f.on("mousemove",function(){d.persistSession()}),f.on("touchmove",function(){d.persistSession()}),f.on("keydown",function(){d.persistSession()}))}]),angular.module("dashboard.Alert",["ui.bootstrap","ui.bootstrap.modal"]).controller("AlertCtrl",["$scope","$uibModalInstance",function(a,b){"ngInject";a.closeAlert=function(){b.close()},a.okAlert=function(){"function"==typeof a.okHandler&&a.okHandler(),b.close()},a.cancelAlert=function(){"function"==typeof a.cancelHandler&&a.cancelHandler(),b.close()},function(){a.isConfirm="confirm"==a.alertType}()}]),angular.module("dashboard.Dashboard",["dashboard.Config","dashboard.Profile","dashboard.Dashboard.Model","dashboard.services.Dashboard","ui.router"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard",{url:"/dashboard",controller:"DashboardCtrl",templateUrl:"app/dashboard/Dashboard.html",data:{pageTitle:"Dashboard"}}).state("portal",{url:"/portal",controller:"DashboardCtrl",templateUrl:"app/dashboard/Dashboard.html",data:{pageTitle:"Dashboard"}})}]).controller("DashboardCtrl",["$scope","$rootScope","$state","$stateParams","$location","$cookies","$uibModal","Config","DashboardService",function(a,b,c,d,e,f,g,h,i){"ngInject";var j=this;this.init=function(){a.toggleSideMenu=j.toggleSideMenu,a.hideSideMenu=j.hideSideMenu,a.editProfile=j.editProfile,a.logout=j.logout,a.locationPath=e.path(),a.username=f.get("username"),a.email=f.get("email"),a.userId=f.get("userId");try{a.userInfo=JSON.parse(f.get("session")),a.userInfo.user.roles=JSON.parse(f.get("roles"))}catch(a){console.error("Unable to parse $cookies.get(session)",a)}if(a.title=h.serverParams.title||"Content Management System",a.nav=i.getNavigation(),"dashboard"==c.current.name&&h.serverParams.defaultNav){var b=i.getDefaultNav(a.nav,angular.copy(h.serverParams.defaultNav));b.state?c.go(b.state,b.params):c.go("dashboard.model.action."+b.route,b.params)}a.$watch(function(){return e.path()},function(){a.locationPath=e.path()}),a.$on("modelEditSaved",function(){a.modalInstance&&a.modalInstance.close()})},this.toggleSideMenu=function(){var a=$(".dashboard");a.hasClass("show-side-menu")?a.removeClass("show-side-menu"):a.addClass("show-side-menu")},this.hideSideMenu=function(){$(".dashboard").removeClass("show-side-menu")},this.editProfile=function(b){b&&b.preventDefault(),a.action={options:{model:h.serverParams.profileModel,key:h.serverParams.profileKey,id:f.get("userId"),hideDelete:!0}},a.modalInstance=g.open({templateUrl:"app/dashboard/profile/Profile.html",controller:"ProfileCtrl",size:"lg",scope:a})},this.logout=function(a){b.logOut(),a&&a.preventDefault()},j.init()}]),angular.module("dashboard.Dashboard.Model",["dashboard.Dashboard.Model.Action","ui.router"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model",{url:"/:model",controller:"DashboardModelCtrl",templateUrl:"app/dashboard/model/DashboardModel.html",data:{pageTitle:"Dashboard"}})}]).controller("DashboardModelCtrl",["$rootScope","$scope","$stateParams","Config",function(a,b,c,d){"ngInject";!function(){b.section=angular.copy(_.find(b.nav,{path:c.model}))}()}]),angular.module("dashboard.Dashboard.Model.Action",["dashboard.Dashboard.Model.Edit","dashboard.Dashboard.Model.List","dashboard.Dashboard.Model.Sort","dashboard.Dashboard.Model.View","dashboard.Dashboard.Model.Nav","dashboard.Dashboard.Model.Definition","ui.router"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action",{url:"/:action",controller:"DashboardModelActionCtrl",templateUrl:"app/dashboard/model/DashboardModelAction.html",data:{pageTitle:"Dashboard"}})}]).controller("DashboardModelActionCtrl",["$scope","$stateParams",function(a,b){"ngInject";!function(){a.section&&a.section.subnav&&(a.action=angular.copy(_.find(a.section.subnav,{label:b.action})))}()}]),angular.module("dashboard.Dashboard.Model.Definition",["dashboard.Config","dashboard.services.Settings","ui.router","ui.bootstrap.modal"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action.definition",{url:"/definition",templateUrl:"app/dashboard/model/definition/ModelDefinition.html",data:{pageTitle:"Settings - Model Definitions"}})}]).controller("ModelDefinitionCtrl",["$scope","$timeout","$state","$location","$uibModal","Config","SettingsService",function(a,b,c,d,e,f,g){"ngInject";a.clickSave=function(){}}]),angular.module("dashboard.Dashboard.Model.Edit",["dashboard.Dashboard.Model.Edit.SaveDialog","dashboard.Config","dashboard.directives.ModelField","dashboard.services.Cache","dashboard.services.GeneralModel","dashboard.services.FileUpload","dashboard.filters.locale","ui.router","ui.bootstrap","ui.bootstrap.datepicker","ui.bootstrap.modal","ngCookies"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action.edit",{url:"/edit/:id",templateUrl:"app/dashboard/model/edit/ModelEdit.html",data:{pageTitle:"Edit"}})}]).constant("modelEditConstants",{keys:{save:"button.save",delete:"button.delete",confirmMessage:"button.delete.confirm"},defaults:{save:"Save",delete:"Delete",confirmMessage:"Are you sure you want to delete this record?"}}).controller("ModelEditCtrl",["$rootScope","$scope","$cookies","$location","$stateParams","$state","$window","$uibModal","$filter","Config","GeneralModelService","FileUploadService","CacheService","modelEditConstants","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"ngInject";function p(){if(b.modelDisplay=b.model.display,b.action.options.display&&(b.modelDisplay=b.model[b.action.options.display]),!b.modelDisplay||0==b.modelDisplay.length){b.modelDisplay=[];var a=Object.keys(b.model.properties);for(var c in a){var d=a[c];b.modelDisplay.push(d),b.data[d]||(b.data[d]=null)}}b.$emit("onModelLoad",{data:b.data})}function q(c){var d=b.data[b.action.options.key];k.saveWithFiles(b.model.name,d,b.data).then(function(b){t&&t.close(),a.$broadcast("modelEditSaved"),c&&c(b)},r,s)}function r(b){if(a.$broadcast("modelEditSaveFailed",{error:b}),_.isPlainObject(b))if("string"==typeof b.translate&&b.translate.length>0){var c=o.instant(b.translate);c===b.translate&&(c=b.message),alert(c)}else b.code||b.message?("ER_DUP_ENTRY"===b.code&&(b.message="There was a duplicate entry found. Please make sure the entry is unique."),alert(b.message)):b.error?r(b.error):alert(angular.toJson(b));else alert(b);t&&t.close()}function s(a){if(_.isPlainObject(a)){if(a.translate){var c=o.instant(a.translate,a.params);b.status=c===a.translate?a.message:c}else a.message&&(b.status=a.message);a.progress&&(b.progress=a.progress)}}var t=null;b.clickSaveModel=function(a){s({message:"Saving",translate:"cms.status.saving",progress:0}),t=h.open({templateUrl:"app/dashboard/model/edit/ModelEditSaveDialog.html",controller:"ModelEditSaveDialogCtrl",scope:b}),q(function(a){m.clear(b.action.options.model),b.action.options&&b.action.options.returnAfterEdit?g.history.back():b.section?f.go(b.section.state?b.section.state:"dashboard.model.action.edit",{model:b.section.path,action:b.action.label,id:a[b.action.options.key]}):t&&t.close()})},b.clickDeleteModel=function(c,d){if(b.deleteDialogText=d&&d.deleteDialogText?d.deleteDialogText:b.deleteDialogText,confirm(b.deleteDialogText)){var e=c[b.action.options.key];b.model.options&&b.model.options.softDeleteProperty?(b.data[b.model.options.softDeleteProperty]=!0,q(function(){m.clear(b.action.options.model),g.history.back()})):k.remove(b.model.plural,e).then(function(c){a.$broadcast("modelDeleted"),m.clear(b.action.options.model),g.history.back()},function(a){"object"==typeof a&&a.message?alert(a.message):"object"==typeof a&&a.error&&a.error.message?alert(a.error.message):"object"==typeof a?alert(JSON.stringify(a)):alert(a)})}},b.hasPermission=function(a){var d=null;if("object"==typeof a)d=a;else{var e=b.model.properties[a];d=e.display}if(!d)return!0;if(d.askIf){var f=Object.keys(d.askIf);for(var g in f){var e=f[g];if(b.data[e]!=d.askIf[e])return!1}}if(!d.roles)return!0;if(!c.get("roles"))return!1;var h=JSON.parse(c.get("roles"));for(var g in h){var i=h[g];if(d.roles.indexOf(i.name)>-1)return!0}return!1},function(){if(b.hideSideMenu(),g.ga&&g.ga("send","pageview",{page:d.path()}),b.action||(b.action={}),b.action.options||(b.action.options={model:e.model,key:e.key}),b.model=angular.copy(j.serverParams.models[b.action.options.model]),b.action.options.key){var a=b.action.options.key;b.model.properties[a].display||(b.model.properties[a].display={}),b.model.properties[a].display.readonly=!0}var c=o.use();if(b.locale=i("iso-639-1")(c),_.forEach(b.model.properties,function(a){if(a.display||(a.display={}),a.display.options||(a.display.options={}),b.action.options.readonly&&(a.display.readonly=!0),"string"==typeof a.type)switch(a.type.toLowerCase()){case"date":case"datetime":a.display.options.locale=b.locale}}),b.isLoading=!0,b.data={},b.action.options.data){var f=Object.keys(b.action.options.data);for(var h in f){var a=f[h];b.data[a]=b.action.options.data[a]}}k.checkDefaultValues(b.model,b.data);var l=null;e.id&&e.id>0&&(l=e.id),b.action.options.id&&b.action.options.id>0&&(l=b.action.options.id),l?(b.isEdit=!0,b.modelDisplay=null,k.get(b.model.plural,l).then(function(a){a&&(b.data=a,p(),b.isLoading=!1)})):(p(),b.isEdit=!1,b.isLoading=!1),o([n.keys.save,n.keys.delete,n.keys.confirmMessage]).then(function(a){b.saveButtonText=a[n.keys.save]==n.keys.save?n.defaults.save:a[n.keys.save],b.deleteButtonText=a[n.keys.delete]==n.keys.delete?n.defaults.delete:a[n.keys.delete],b.deleteDialogText=a[n.keys.confirmMessage]==n.keys.confirmMessage?n.defaults.confirmMessage:a[n.keys.confirmMessage]},function(a){b.saveButtonText=n.defaults.save,b.deleteButtonText=n.defaults.delete,b.deleteDialogText=n.defaults.confirmMessage}),b.$on("saveModel",function(){b.clickSaveModel(b.data)}),b.$on("deleteModel",function(a,c){b.clickDeleteModel(b.data,c)}),b.$on("onModelSave",function(){b.clickSaveModel(b.data)}),b.$on("onModelDelete",function(a,c){b.clickDeleteModel(b.data,c)}),b.$watchCollection("data",function(a,c){b.isLoading||b.$emit("onModelChange",a,c)}),b.$on("onModelFieldReferenceChange",function(a,c,d,e){b.data.hasOwnProperty(c)&&_.isEqual(d,e)||(b.data[c]=d)})}()}]),angular.module("dashboard.Dashboard.Model.Edit.SaveDialog",["ui.bootstrap","ui.bootstrap.progressbar","ui.bootstrap.modal"]).controller("ModelEditSaveDialogCtrl",["$scope","$translate",function(a,b){"ngInject";!function(){a.statusLabel="Status",b("cms.status").then(function(b){"string"==typeof b&&b.length>0&&"cms.status"!==b&&(a.statusLabel=b)},function(a){console.log("Failed to translate cms.status",a)})}()}]),angular.module("dashboard.Dashboard.Model.List",["dashboard.Dashboard.Model.Edit.SaveDialog","dashboard.Config","dashboard.services.Cache","dashboard.services.GeneralModel","dashboard.directives.ModelFieldReference","ui.router","ngCookies","ngGrid","googlechart"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action.list",{url:"/list",templateUrl:"app/dashboard/model/list/ModelList.html",data:{pageTitle:"List"}})}]).controller("ModelListCtrl",["$scope","$cookies","$timeout","$state","$location","$window","$uibModal","Config","GeneralModelService","CacheService",function ModelListCtrl($scope,$cookies,$timeout,$state,$location,$window,$uibModal,Config,GeneralModelService,CacheService){"ngInject";function init(){if($scope.isLoading=!0,$scope.moment=moment,$scope.columnCount=0,$scope.list=[],$scope.selected=[],$scope.columns=[],$scope.listTemplateUrl="",$scope.totalServerItems=0,$scope.isEditing=!1,$scope.searchFields=$scope.action.options.searchFields,$scope.action.options.sort?$scope.sortInfo=$scope.action.options.sort:$scope.sortInfo={fields:[$scope.action.options.key],directions:["ASC"]},$scope.filterOptions={filterText:"",useExternalFilter:"boolean"==typeof $scope.action.options.useExternalFilter&&$scope.action.options.useExternalFilter},$scope.pagingOptions={pageSizes:["25","50","100","250","500"],pageSize:$scope.action.options.pageSize?$scope.action.options.pageSize:"25",currentPage:1},$scope.action.options.pageSize){var a=$scope.action.options.pageSize.toString(),b=$scope.pagingOptions.pageSizes.indexOf(a);$scope.pagingOptions.pageSizes=$scope.pagingOptions.pageSizes.slice(0,b+1)}$scope.sortInfo||($scope.sortInfo={}),$scope.sortInfo.columns||($scope.sortInfo.columns=[]),$scope.gridOptions={data:"list",enableColumnResize:!0,enableRowSelection:"boolean"!=typeof $scope.action.options.enableRowSelection||$scope.action.options.enableRowSelection,multiSelect:!1,enablePaging:!0,useExternalSorting:!0,showSelectionCheckbox:!1,sortInfo:$scope.sortInfo,showFooter:!0,showFilter:$scope.action.options.showFilter,headerRowHeight:44,footerRowHeight:44,totalServerItems:"totalServerItems",pagingOptions:$scope.pagingOptions,filterOptions:$scope.filterOptions,selectedItems:$scope.selected,rowHeight:$scope.action.options.rowHeight?$scope.action.options.rowHeight:44},$scope.hideSideMenu(),$window.ga&&$window.ga("send","pageview",{page:$location.path()}),$scope.gridContainerTopMargin=0,$scope.action.options.chart&&($scope.gridContainerTopMarginMax=$scope.action.options.chart.height+60,$scope.gridContainerTopMargin=$scope.gridContainerTopMarginMax,processChart()),window.ngGrid.i18n.en.ngTotalItemsLabel="Total Records: ",window.ngGrid.i18n.en.ngPageSizeLabel="Show: ",$scope.columns=getColumnDefinition(),$scope.gridOptions.columnDefs="columns",$scope.action.options.editable&&($scope.gridOptions.enableCellEdit=!0,$scope.gridOptions.enableCellEditOnFocus=!1,$scope.gridOptions.enableCellSelection=!0,$scope.gridOptions.enableRowSelection=!1),$scope.action.options.params||($scope.action.options.params={}),$scope.action.options.model&&($scope.model=Config.serverParams.models[$scope.action.options.model]),$scope.action.options.api?$scope.apiPath=$scope.action.options.api:$scope.action.options.model&&($scope.apiPath=$scope.model.plural),$scope.origApiPath=$scope.apiPath,addQueryStringParams(),$scope.getTotalServerItems(),$timeout(function(){$(".ngFooterPanel select").addClass("form-control"),$(".ngFooterPanel button").addClass("btn btn-default")}),$scope.$grid=$(".grid"),angular.element($window).bind("resize",function(){processWindowSize()}),$scope.$on("ngGridEventStartCellEdit",function(){startEdit()}),$scope.$on("ModelListLoadItems",function(a,b){b&&b.resetPaging&&($scope.pagingOptions.currentPage=1),$scope.getTotalServerItems()}),(/(iPad|iPhone|iPod|Android)/g.test(navigator.userAgent)||$scope.action.options.flexibleHeight)&&($scope.gridOptions.plugins=[new ngGridFlexibleHeightPlugin]),$scope.action.options.allowCSVExport&&($scope.gridOptions.plugins||($scope.gridOptions.plugins=[]),$scope.gridOptions.plugins.push(new ngGridCsvExportPlugin)),Config.serverParams.strings&&($scope.cancelButtonText=Config.serverParams.strings.cancelButton,$scope.saveButtonText=Config.serverParams.strings.saveButton),$scope.$on("RemoveSelectedItems",function(){removeSelectedItems()})}function removeSelectedItems(){for(var a in selectedItems)selectedItems[a].isChecked=!1;selectedItems=[],$scope.action.selectAll=!1,$scope.$emit("SelectedModelList",{list:selectedItems})}function getColumnDefinition(){var a=$scope.action.options.columnRef,b=$scope.action.options.columns;if(a&&"object"==typeof a&&a.label)if(a.path){var c=_.find(Config.serverParams.nav,{path:a.path}),d=_.find(c.subnav,{label:a.label});b=d.options.columns}else{var d=_.find($scope.section.subnav,{label:a.label});b=d.options.columns}if((b=angular.copy(b))&&$cookies.get("roles")){var e=JSON.parse($cookies.get("roles"));if(e)for(var f=0;f<b.length;f++){var g=b[f];if(g.roles){var h=!1;for(var i in e){var j=e[i];if(g.roles.indexOf(j.name)>-1){h=!0;break}}h||(b.splice(f,1),f--)}}}return b}function processWindowSize(){var a=$scope.$grid,b=$window.innerWidth,c=b/$scope.columnCount;c<90&&!a.hasClass("hide-optional")?(a.addClass("hide-optional"),$scope.columns=$scope.columns.filter(function(a){return!a.optional})):c>=90&&a.hasClass("hide-optional")&&(a.removeClass("hide-optional"),$scope.columns=$scope.columns=getColumnDefinition())}function addQueryStringParams(){var queryStringParams=$location.search();$scope.queryStringParams=queryStringParams,$scope.apiPath=$scope.origApiPath;var keys=Object.keys(queryStringParams);for(var i in keys){var key=keys[i];$scope.action.options.params[key]=queryStringParams[key],$scope.apiPath&&($scope.apiPath=$scope.apiPath.replace("{"+key+"}",queryStringParams[key]))}try{for(var session=JSON.parse($cookies.get("session")),searchString="{session.",startPos=$scope.apiPath.indexOf(searchString);startPos>-1;){var endPos=$scope.apiPath.indexOf("}",startPos);if(-1==endPos){console.error("ModelList session parsing malformed for $scope.apiPath");break}var sessionKey=$scope.apiPath.substring(startPos+1,endPos);$scope.apiPath=$scope.apiPath.slice(0,startPos)+eval(sessionKey)+$scope.apiPath.slice(endPos+1),startPos=$scope.apiPath.indexOf(searchString)}}catch(a){console.error(a)}var filterDescription=queryStringParams.filterDescription;if($scope.filterDescription=filterDescription||$scope.action.label,queryStringParams.pageSize?$scope.pagingOptions.pageSize=queryStringParams.pageSize:$scope.action.options.pageSize&&($scope.pagingOptions.pageSize=$scope.action.options.pageSize.toString()),queryStringParams.currentPage&&($scope.pagingOptions.currentPage=parseInt(queryStringParams.currentPage)),queryStringParams.sortInfo)try{var sortInfo=JSON.parse(queryStringParams.sortInfo);_.extend($scope.sortInfo,sortInfo)}catch(a){console.warn("There are errors with the querystring param 'pagingOptions'")}queryStringParams.search&&($scope.filterOptions.filterText=queryStringParams.search)}function setupPagination(){var a=angular.copy($scope.action.options.params);if(a&&a.filter&&a.filter.length>0)try{var b=JSON.parse(a.filter);if(b.limit=parseInt($scope.pagingOptions.pageSize),b.skip=($scope.pagingOptions.currentPage-1)*parseInt($scope.pagingOptions.pageSize),$scope.sortInfo.fields.length>0){b.order="";for(var c in $scope.sortInfo.fields){var d=$scope.sortInfo.fields[c],e=$scope.sortInfo.directions[c];e||(e="ASC"),parseInt(c)>0&&(b.order+=", "),b.order+=d+" "+e}}a.filter=JSON.stringify(b)}catch(a){console.error(a),alert("Error with list filter. Please contact administrator for assistance.")}else{if(a=_.extend(a,{"filter[limit]":parseInt($scope.pagingOptions.pageSize),"filter[skip]":($scope.pagingOptions.currentPage-1)*parseInt($scope.pagingOptions.pageSize)}),$scope.sortInfo.fields.length>0){var f="";for(var c in $scope.sortInfo.fields){var d=$scope.sortInfo.fields[c],e=$scope.sortInfo.directions[c];e||(e="ASC"),parseInt(c)>0&&(f+=", "),f+=d+" "+e}a=_.extend(a,{"filter[order]":f})}if($scope.searchFields&&$scope.gridOptions.filterOptions.filterText){a=GeneralModelService.queryStringParamsToJSON(a);var g=$scope.gridOptions.filterOptions.filterText;if("object"==typeof a.filter.where){var h=angular.copy(a.filter.where);a.filter.where={and:[]},_.forEach(h,function(b,c){var d={};d[c]=b,a.filter.where.and.push(d)});var i={or:[]};angular.forEach($scope.searchFields,function(a,b){var c="["+a+"][like]",d=_.set({},c,"%"+g+"%");i.or.push(d)}),a.filter.where.and.push(i)}else angular.forEach($scope.searchFields,function(b,c){var d="filter[where][or]["+c+"]["+b+"][like]";a=_.set(a,d,"%"+g+"%")})}}$location.search("pageSize",$scope.pagingOptions.pageSize),$location.search("currentPage",$scope.pagingOptions.currentPage);var j=angular.copy($scope.sortInfo);return delete j.columns,$location.search("sortInfo",JSON.stringify(j)),$location.replace(),addQueryStringParams(),a}function processChart(){$scope.action.options.chart.api&&GeneralModelService.list($scope.action.options.chart.api,{}).then(function(a){$scope.chart=$scope.action.options.chart,$scope.chart.data=a,$scope.chart.options||($scope.chart.options={}),$scope.chart.options.vAxis||($scope.chart.options.vAxis={}),$scope.chart.options.hAxis||($scope.chart.options.hAxis={}),$scope.chart.options.hAxis.textStyle||($scope.chart.options.hAxis.textStyle={}),$scope.chart.options.vAxis.textStyle||($scope.chart.options.vAxis.textStyle={}),$scope.chart.options.vAxis.gridlines||($scope.chart.options.vAxis.gridlines={}),$scope.chart.options.hAxis.textStyle.fontSize||($scope.chart.options.hAxis.textStyle.fontSize=11),$scope.chart.options.vAxis.textStyle.fontSize||($scope.chart.options.vAxis.textStyle.fontSize=11),$scope.chart.options.hAxis.textStyle.color||($scope.chart.options.hAxis.textStyle.color="#999"),$scope.chart.options.vAxis.textStyle.color||($scope.chart.options.vAxis.textStyle.color="#999"),$scope.chart.options.vAxis.baselineColor||($scope.chart.options.vAxis.baselineColor="#999"),$scope.chart.options.hAxis.baselineColor||($scope.chart.options.hAxis.baselineColor="#999"),$scope.chart.options.vAxis.gridlines.color||($scope.chart.options.vAxis.gridlines.color="#eee"),$scope.chart.options.hAxis.gridlines.color||($scope.chart.options.hAxis.gridlines.color="#eee")})}function startEdit(){$scope.isEditing||($scope.oldList=angular.copy($scope.list),$scope.isEditing=!0)}function endEdit(){$scope.isEditing&&($scope.isEditing=!1,$scope.oldList=void 0,$scope.loadItems())}var isFirstLoad=!0,modalInstance=null,selectedItems=[];$scope.clickSelectAll=function(){for(var a in $scope.list)if($scope.list[a].isChecked&&!$scope.action.selectAll){$scope.list[a].isChecked=!1;var b=selectedItems.indexOf($scope.list[a]);selectedItems.splice(b,1)}else $scope.action.selectAll&&selectedItems.indexOf($scope.list[a])<0&&($scope.list[a].isChecked=!0,selectedItems.push($scope.list[a]));$scope.$emit("SelectedModelList",{list:selectedItems})},$scope.clickItemCheckbox=function(a){var b=selectedItems.indexOf(a)>-1;if(a.isChecked&&!b)selectedItems.push(a);else if(b){var c=selectedItems.indexOf(a);selectedItems.splice(c,1),0==selectedItems.length&&($scope.action.selectAll=!1)}$scope.$emit("SelectedModelList",{list:selectedItems})},$scope.getTotalServerItems=function(){$scope.isLoading=!0,$scope.list=[],$scope.totalServerItems=0;var a=setupPagination();GeneralModelService.count($scope.apiPath,a).then(function(b){if(b){if("string"==typeof b)$scope.totalServerItems=b;else{b instanceof Array&&b.length>0&&(b=b[0]);var c=Object.keys(b);!b.count&&c.length>0&&(b.count=b[c[0]]),$scope.totalServerItems=b.count}parseInt($scope.totalServerItems)>0?$scope.loadItems(a):($scope.isLoading=!1,$scope.loadAttempted=!0)}},function(a){$scope.isLoading=!1,$scope.errorMessage="There was an error while loading...",console.error(a)})},$scope.loadItems=function(a){$scope.isLoading=!0,$scope.list=[],$scope.$emit("ModelListLoadItemsLoading"),a||(a=setupPagination());var b=CacheService.getKeyForAction($scope.action,a);if(!$scope.filterOptions.useExternalFilter&&CacheService.get(b))try{$scope.list=CacheService.get(b),$scope.columnCount=$scope.list.length>0?Object.keys($scope.list[0]).length:0,processWindowSize()}catch(a){console.warn("ModelList Cache is corupt for key = "+b)}GeneralModelService.list($scope.apiPath,a).then(function(a){a&&(void 0!==$scope.action.options.resultField&&void 0!==a[$scope.action.options.resultField]?$scope.list=a[$scope.action.options.resultField]:$scope.list=a,$scope.columnCount=$scope.list.length>0?Object.keys($scope.list[0]).length:0,$scope.filterOptions.useExternalFilter||CacheService.set(b,$scope.list),$scope.$emit("ModelListLoadItemsLoaded"),isFirstLoad=!1,$scope.isLoading=!1,$scope.loadAttempted=!0,processWindowSize())},function(a){$scope.isLoading=!1,$scope.errorMessage="There was an error while loading...",console.error(a)})},$scope.hasButtonPermission=function(a){if(!a.roles)return!0;if(!$cookies.get("roles"))return!1;var b=JSON.parse($cookies.get("roles"));for(var c in b){var d=b[c];if(a.roles.indexOf(d.name)>-1)return!0}return!1},$scope.clickListButton=function(button){if(button.click)eval("$scope."+button.click);else if(button.route){if(button.options&&(button.options.model&&($scope.action.options.model=button.options.model),button.options.key&&($scope.action.options.key=button.options.key),button.options.display&&($scope.action.options.display=button.options.display),button.returnAfterEdit&&($scope.action.options.returnAfterEdit=button.returnAfterEdit),button.options.data)){var keys=Object.keys(button.options.data);for(var i in keys){var key=keys[i],value=button.options.data[key];value.lastIndexOf("{")>-1&&(value=value.substring(value.lastIndexOf("{")+1,value.lastIndexOf("}")),value=$scope.queryStringParams[value]),$scope.action.options.data||($scope.action.options.data={}),$scope.action.options.data[key]=value}}$state.go("dashboard.model.action."+button.route)}else if(button.path&&button.label){var section=_.find(Config.serverParams.nav,{path:button.path}),action=_.find(section.subnav,{label:button.label});$state.go("dashboard.model.action."+action.route,{model:section.path,action:action.label})}},$scope.clickAdd=function(){$scope.list&&$scope.list.length,$scope.list.push({}),startEdit()},$scope.clickSaveEdit=function(){if($scope.oldList){var deltaList=[];for(var i in $scope.list){var newRow=$scope.list[i],oldRow=$scope.oldList[i];if(newRow&&("object"!=typeof newRow||0!=Object.keys(newRow).length)&&0!=newRow.length&&(!oldRow||JSON.stringify(newRow)!=JSON.stringify(oldRow))){var rowKeys=Object.keys(newRow);for(var i in rowKeys){var key=rowKeys[i];newRow[key]&&"object"==typeof newRow[key]&&delete newRow[key]}if($scope.action.options.defaults){var keys=Object.keys($scope.action.options.defaults);for(var i in keys){var key=keys[i],property=$scope.action.options.defaults[key];!property||!property.foreceDefaultOnSave&&newRow[key]||(property.default?newRow[key]=property.default:property.evalDefault&&(newRow[key]=eval(property.evalDefault)))}}if($scope.action.options.columns)for(var i in $scope.action.options.columns){var column=$scope.action.options.columns[i];if(column.required&&!newRow[column.field])return void alert("Please fill in all required fields: "+column.displayName)}deltaList.push(newRow)}}var recordIndex=0;$scope.status="Saving...",$scope.progress=0,modalInstance=$uibModal.open({templateUrl:"app/dashboard/model/edit/ModelEditSaveDialog.html",controller:"ModelEditSaveDialogCtrl",scope:$scope});var saveRecord=function(a,b){var c=a[$scope.action.options.key];GeneralModelService.save($scope.action.options.model,c,a).then(function(a){b()},function(a){if("object"==typeof a&&a.message)alert(a.message);else if("object"==typeof a&&a.error&&a.error.message)alert(a.error.message);else if("object"==typeof a&&a.code)switch(a.code){case"ER_DUP_ENTRY":alert("There was a duplicate entry found. Please make sure the entry is unique.")}else"object"==typeof a?alert(JSON.stringify(a)):alert(a);b()})},saveNextRecord=function(){if(recordIndex>=deltaList.length)return $scope.status="Saved Successful",modalInstance&&modalInstance.close(),$scope.loadItems(),void endEdit();$scope.status="Saving "+(recordIndex+1)+" of "+deltaList.length,$scope.progress=(recordIndex+1)/deltaList.length;var a=deltaList[recordIndex];saveRecord(a,function(){recordIndex++,saveNextRecord()})};saveNextRecord()}},$scope.clickCancelEdit=function(){confirm("Are you sure you want can cancel all changes?")&&endEdit()},$scope.deleteRowWithMessage=function(a,b){if(b)return void(confirm(b)&&$scope.deleteRow(a,!0));$scope.deleteRow(a)},$scope.deleteRow=function(a,b){if(!$scope.model||!$scope.model.plural)return void console.error("$scope.model or $scope.model.plural not found!");if(b||confirm("Are you sure you want to delete this item?")){var c=a.entity[$scope.action.options.key];c?$scope.model.options&&$scope.model.options.softDeleteProperty?(startEdit(),a.entity[$scope.model.options.softDeleteProperty]=!0,$scope.clickSaveEdit()):GeneralModelService.remove($scope.model.plural,c).then(function(b){$scope.list.splice(a.rowIndex,1)},function(a){"object"==typeof a&&a.message?alert(a.message):"object"==typeof a&&a.error&&a.error.message?alert(a.error.message):"object"==typeof a?alert(JSON.stringify(a)):alert(a)}):$scope.list.splice(a.rowIndex,1)}},$scope.$watch("selected",function(a,b){a!==b&&a.length>0&&!$scope.action.options.editable&&($scope.action.options.selectedState?$state.go($scope.action.options.selectedState.stateName||"dashboard.model.action.edit",{model:$scope.action.options.selectedState.stateModel||$scope.section.path,key:$scope.action.options.key,action:$scope.action.options.selectedState.stateAction||$scope.action.label,id:a[0][$scope.action.options.selectedState.stateId||$scope.action.options.key]}):$state.go("dashboard.model.action.edit",{model:$scope.section.path,key:$scope.action.options.key,
action:$scope.action.label,id:a[0][$scope.action.options.key]}))},!0),$scope.$watch("pagingOptions",function(a,b){a.currentPage==b.currentPage&&a.pageSize==b.pageSize||($scope.pagingOptions.pageSize=$scope.pagingOptions.pageSize.toString(),$scope.loadItems())},!0),$scope.$watch("gridOptions.$gridScope.filterText",_.debounce(function(a,b){a!=b&&$scope.$apply(function(){$scope.pagingOptions.currentPage=1,$scope.filterOptions.filterText=a,$scope.getTotalServerItems()})},250),!0),$scope.$watch("sortInfo",function(a,b){isFirstLoad||a===b||$scope.loadItems()},!0);var ngGridUnWatch=$scope.$watch("gridOptions.ngGrid",function(){if($scope.gridOptions.ngGrid){var a=$scope.gridOptions.ngGrid.$viewport;ngGridUnWatch(),$footerPanel=$(".ngFooterPanel"),$listContainer=$(".grid-container.list");var b=null,c=function(){$scope.gridOptions.$gridServices.DomUtilityService.RebuildGrid($scope.gridOptions.$gridScope,$scope.gridOptions.ngGrid)},d=function(d){var e=d.originalEvent.detail?-d.originalEvent.detail:d.originalEvent.wheelDelta/4,f=a.scrollTop();if(e<0){var f=a.scrollTop();0==f&&(f=-e),$scope.gridContainerTopMargin-f>0?($scope.gridContainerTopMargin-=f,a.height(a.height()+f),a.scrollTop(0)):(a.height(a.height()+$scope.gridContainerTopMargin),$scope.gridContainerTopMargin=0),$scope.gridOptions.$gridServices&&(clearTimeout(b),b=setTimeout(c,30))}else e>0&&(0==f&&$scope.gridContainerTopMargin<$scope.gridContainerTopMarginMax?(f=e,$scope.gridContainerTopMargin+=f,a.height(a.height()-f)):0==f&&($scope.gridContainerTopMargin=$scope.gridContainerTopMarginMax,a.height($footerPanel.offset().top-a.offset().top)));$scope.$digest()};(/(iPad|iPhone|iPod|Android)/g.test(navigator.userAgent)||$scope.action.options.flexibleHeight)&&($(".model-list .grid-container").addClass("flexible"),$(".model-list .grid").css({bottom:"auto"}),$(".model-list .ngFooterPanel").css({position:"static",bottom:"auto"})),$scope.action.options.chart&&(angular.element($window).bind("mousewheel",d),angular.element($window).bind("DOMMouseScroll",d)),$(".search .ngColMenu input").on("keyup",function(){$location.search("search",$(this).val()),$location.replace()})}});init()}]).filter("encodeURIComponent",function(){return window.encodeURIComponent}),angular.module("dashboard.Dashboard.Model.Nav",["dashboard.Config","dashboard.services.Settings","ui.router","ui.bootstrap.modal"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action.nav",{url:"/config",templateUrl:"app/dashboard/model/nav/ModelNav.html",data:{pageTitle:"Settings - Navigation"}})}]).controller("ModelNavCtrl",["$scope","$timeout","$state","$location","$uibModal","Config","SettingsService",function(a,b,c,d,e,f,g){"ngInject";function h(a){for(var b=angular.copy(j),c=0;c<b.length;c++){var d=b[c];a!=c&&delete d.subnav}return b}var i=null,j=null,k=null,l=0;a.clickSave=function(){a.alertTitle="Saving...",a.alertMessage="Saving navigation settings",a.allowAlertClose=!1,k=e.open({templateUrl:"app/dashboard/alert/Alert.html",controller:"AlertCtrl",size:"sm",scope:a});var b=i.getEditor("root."+l);j[l]=b.getValue(),console.log(JSON.stringify(j,null,"  ")),g.saveNav(j).then(function(b){a.alertMessage="Saved Successful!",a.allowAlertClose=!0},function(a){"object"==typeof a&&a.message?alert(a.message):"object"==typeof a&&a.error&&a.error.message?alert(a.error.message):"object"==typeof a?alert(JSON.stringify(a)):alert(a)})},function(){a.hideSideMenu(),j=angular.copy(f.serverParams.nav);var b=h(l),c=document.getElementById("navigation"),d={theme:"bootstrap3",iconlib:"fontawesome4",layout:"tree",startval:b,disable_properties:!1,disable_edit_json:!0,disable_delete_all:!0,disable_delete_last:!0,schema:{type:"array",title:"Navigation",format:"tabs",options:{disable_collapse:!0},items:{title:"Section",type:"object",headerTemplate:"{{self.label}}",id:"item",properties:{label:{title:"Label",type:"string",required:!0},path:{title:"Path",type:"string",required:!0},icon:{title:"Icon",type:"string",required:!0},subnav:{title:"Sub-Navigation",type:"array",required:!0,items:{title:"Sub Nav",headerTemplate:"{{self.label}}",type:"object",options:{collapsed:!0,disable_properties:!1},properties:{label:{title:"Label",type:"string",required:!0},className:{title:"ClassName",type:"string",required:!1},route:{title:"Route",type:"string",enum:["list","sort","edit","nav","definition"],required:!0},options:{type:"object",options:{disable_properties:!1},properties:{api:{tite:"API",type:"string"},eval:{tite:"eval",type:"string"},model:{title:"Model",type:"string"},key:{title:"Key",type:"string"},rowHeight:{title:"Row Height",type:"integer"},sortField:{title:"Sort Field",type:"string"},title:{title:"Title Field",description:"Field name to display when sorting",type:"string"},params:{type:"object",options:{collapsed:!0},properties:{filter:{title:"Filter",type:"string",format:"json"}}},columnRef:{title:"Column Reference",type:"object",options:{collapsed:!0,disable_properties:!1},properties:{path:{title:"Section Path",type:"string"},label:{title:"Subnav Label",type:"string"}}},columns:{title:"Columns",type:"array",items:{title:"column",type:"object",headerTemplate:"{{self.displayName}}",options:{collapsed:!0,disable_properties:!1},properties:{field:{title:"Field",type:"string",required:!0},displayName:{title:"Display Name",type:"string",required:!0},width:{title:"Width",type:"number"},headerClass:{title:"Header Class",type:"string"},cellClass:{title:"Cell Class",type:"string"},cellTemplate:{title:"Cell Template",type:"string",format:"html"},cellFilter:{title:"Cell Filter",type:"string"},minWidth:{type:"string"},maxWidth:{type:"string"},sortable:{title:"Sortable",type:"string"},resizable:{title:"Resizable",type:"string"}},defaultProperties:["field","displayName"]}}},defaultProperties:[]}}}},defaultSubNavIndex:{title:"Default Sub Nav",type:"string",watch:{subnav:"item.subnav"},enumSource:[{source:"subnav",title:"{{item.label}}",value:"{{i}}"}]}}}}};i=new JSONEditor(c,d),i.on("ready",function(){}),i.on("moveup",function(a){if("root"==a.row.parent.key){var b=j[l-1];j[l-1]=j[l],j[l]=b,l--,console.log("currentNavIndex = "+l)}}),i.on("movedown",function(a){if("root"==a.row.parent.key){var b=j[l+1];j[l+1]=j[l],j[l]=b,l++,console.log("currentNavIndex = "+l)}}),i.on("tabclick",function(a){var b=i.getEditor("root."+l);j[l]=b.getValue(),l=a.index,(b=i.getEditor("root."+l))&&b.setValue(j[l])})}()}]),angular.module("dashboard.Dashboard.Model.Sort",["dashboard.Config","dashboard.services.GeneralModel","dashboard.Alert","ui.router","ui.sortable","ui.bootstrap.modal"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action.sort",{url:"/sort",templateUrl:"app/dashboard/model/sort/ModelSort.html",data:{pageTitle:"Sort"}})}]).controller("ModelSortCtrl",["$scope","$timeout","$state","$uibModal","$window","Config","GeneralModelService","$location",function(a,b,c,d,e,f,g,h){"ngInject";a.list=[];var i=null;a.loadItems=function(){a.action.options.params||(a.action.options.params={});var b=a.action.options.params;b["filter[order]"]=a.action.options.sortField+" DESC",a.action.options.api?a.apiPath=a.action.options.api:a.action.options.model&&(a.apiPath=a.model.plural),g.list(a.apiPath,b).then(function(b){b&&(a.list=b.sort(function(b,c){return b[a.action.options.sortField]<c[a.action.options.sortField]?1:b[a.action.options.sortField]>c[a.action.options.sortField]?-1:0}))})},a.moveUp=function(b){var c=a.list.indexOf(b);if(0!=c){var d=c-1;a.list.splice(d,0,a.list.splice(c,1)[0])}},a.moveDown=function(b){var c=a.list.indexOf(b);if(c!=a.list.length-1){var d=c+1;a.list.splice(d,0,a.list.splice(c,1)[0])}},a.edit=function(b){a.action.options.onEdit?a.action.options.onEdit(b[a.action.options.key]):c.go("dashboard.model.action.edit",{model:a.section.path,action:a.action.label,id:b[a.action.options.key]})},a.saveSort=function(){a.alertTitle="Saving...",a.alertMessage="Saving new sort order",a.allowAlertClose=!1,i=d.open({templateUrl:"app/dashboard/alert/Alert.html",controller:"AlertCtrl",size:"sm",scope:a});var b=[];for(var c in a.list){var e=a.list[c],f=e[a.action.options.key];b.unshift(f)}g.sort(a.action.options.model,a.action.options.key,a.action.options.sortField,b).then(function(b){a.alertMessage="Saved Successful!",a.allowAlertClose=!0},function(a){"object"==typeof a&&a.message?alert(a.message):"object"==typeof a&&a.error&&a.error.message?alert(a.error.message):"object"==typeof a?alert(JSON.stringify(a)):alert(a)})},function(){a.hideSideMenu(),e.ga&&e.ga("send","pageview",{page:h.path()}),a.action.options.params||(a.action.options.params={}),a.model=f.serverParams.models[a.action.options.model],a.title=a.action.options.title?a.action.options.title:a.action.options.key,a.loadItems()}()}]),angular.module("dashboard.Dashboard.Model.View",["dashboard.Config","dashboard.directives.ModelField","dashboard.services.GeneralModel","ui.router"]).config(["$stateProvider",function(a){"ngInject";a.state("dashboard.model.action.view",{url:"/view/:id",controller:"ModelViewCtrl",templateUrl:"app/dashboard/model/view/ModelView.html",data:{pageTitle:"View"}})}]).controller("ModelViewCtrl",["$scope","$stateParams","Config","GeneralModelService",function(a,b,c,d){"ngInject";!function(){d.get(a.model.model,b.id).then(function(b){a.data=b})}()}]),angular.module("dashboard.Profile",["ui.bootstrap","ui.bootstrap.modal","dashboard.Dashboard.Model.Edit"]).controller("ProfileCtrl",["$scope","$translate",function(a,b){!function(){b("user_profile.title").then(function(b){a.modalTitle=b},function(){a.modalTitle="User Profile"})}()}]),angular.module("dashboard.Login",["dashboard.Config","dashboard.services.Cache","dashboard.services.Session","ui.router"]).config(["$stateProvider",function(a){"ngInject";a.state("public.login",{url:"/login",controller:"LoginCtrl",templateUrl:"app/login/Login.html",data:{pageTitle:"Login"}})}]).controller("LoginCtrl",["$scope","$state","$window","Config","SessionService","CacheService",function(a,b,c,d,e,f){"ngInject";var g=this;this.init=function(){a.login={},a.clickLogin=g.clickLogin},this.clickLogin=function(){e.logIn(a.login.email,a.login.password).then(function(a){var c=f.get("desiredState");f.reset(),c?b.go(c.state.name,c.params):b.go("dashboard")}).catch(function(a){a&&a[0]&&a[0].error&&a[0].error.message?alert(a[0].error.message):alert("Invalid login.")})},g.init()}]),angular.module("dashboard.Register",["dashboard.Config","dashboard.services.Session","dashboard.services.User","ui.router"]).config(["$stateProvider",function(a){"ngInject";a.state("public.register",{url:"/register",controller:"RegisterCtrl",templateUrl:"app/Register/Register.html",data:{pageTitle:"Register"}})}]).controller("RegisterCtrl",["$scope","Config","SessionService","UserService",function(a,b,c,d){"ngInject";a.login={},a.register=function(){d.register(a.login.email,a.login.password).then(function(b){c.logIn(a.login.email,a.login.password).then(function(a){$state.go("dashboard")}).catch(function(a){alert("Error registering")})}).catch(function(a){alert("Error registering")})}}]),angular.module("dashboard.Config",[]).constant("Config",{apiBaseUrl:window.config.apiBaseUrl||"/api/",serverParams:window.config}),angular.module("dashboard.directive.DateTimePicker",[]).directive("dateTimePicker",["$rootScope",function(a){"ngInject";return{require:"?ngModel",restrict:"AE",scope:{control:"=",format:"@",ngFormat:"=ngFormat",ngTimeZone:"=ngTimeZone",defaultDate:"@",viewMode:"@",ngViewMode:"=ngViewMode",horizontal:"@",locale:"@",maxDate:"@",minDate:"@"},link:function(a,b,c,d){a.format||(a.format=a.ngFormat),a.viewMode||(a.viewMode=a.ngViewMode),a.format&&a.format.indexOf("DD-MMM-YYYY")>-1&&"es"===a.locale&&(a.format=a.format.replace("DD-MMM-","DD MMM ")),d.$formatters.push(function(b){if(a.format||(a.format=a.ngFormat),b){var c=moment(b);return a.ngTimeZone&&c.tz&&(c=c.tz(a.ngTimeZone)),c.format(a.format)}}),a.defaultDate=a.defaultDate&&"string"==typeof a.defaultDate?a.defaultDate.replace(/"/g,""):a.defaultDate;var e={format:a.format,useCurrent:!1,locale:a.locale,defaultDate:a.defaultDate?moment(a.defaultDate).toDate():void 0,viewMode:a.viewMode,widgetPositioning:{horizontal:a.horizontal?a.horizontal:"auto"}};a.minDate&&(e.minDate=a.minDate),a.maxDate&&(e.maxDate=a.maxDate),b.datetimepicker(e),a.control||(a.control={}),a.control.show=function(){b.focus()},b.on("blur",function(){a.format||(a.format=a.ngFormat),a.locale&&moment.locale(a.locale);var c=moment(b.val(),a.format);c.isValid()?d.$setViewValue(c):d.$setViewValue(null)})}}}]),angular.module("dashboard.directives",[]),angular.module("dashboard.directives.ModelField",["dashboard.directives.ModelFieldImage","dashboard.directives.ModelFieldVideo","dashboard.directives.ModelFieldFile","dashboard.directives.ModelFieldReference","dashboard.directives.ModelFieldReferenceSort","dashboard.directives.ModelFieldList","dashboard.directives.ModelFieldWYSIWYG","dashboard.directives.ModelFieldCanvas","dashboard.directives.ModelFieldLocation","dashboard.directives.ModelFieldPointsOfInterest","dashboard.directives.ModelFieldMultiSelect","dashboard.directives.ModelFieldNumber","dashboard.directive.DateTimePicker","ngCookies","ngSlider","ngSignaturePad","cwill747.phonenumber","monospaced.elastic"]).directive("modelFieldView",["$compile",function(a){"ngInject";function b(a){return"<b>{{ field.label }}</b>: {{ data[field.name] }}"}return{restrict:"E",scope:{key:"=key",model:"=model",data:"=ngModel"},link:function(c,d,e){d.html(b(c.field.type)).show(),a(d.contents())(c)}}}]).directive("modelFieldEdit",["$compile",function(a){"ngInject";function b(a,b){var c="";switch(a){case"reference":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-reference-edit key="key" property="property" options="display.options" model-data="data" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required || property.display.required }}" ng-disabled="display.readonly" />             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"reference-sort":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-reference-sort-edit key="key" property="property" options="display.options" model-data="data" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required }}" ng-disabled="display.readonly"  />             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>           <label class="col-sm-2 control-label"></label>           <div class="col-sm-10">             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"list":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-list-edit key="key" property="property" options="display.options" model-data="data" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required }}" ng-disabled="display.readonly"  />             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>           <label class="col-sm-2 control-label"></label>           <div class="col-sm-10">             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"file":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-file-edit key="key" options="display.options" ng-disabled="display.readonly" model-data="data" ng-model="data[key]" class="field" />           </div>           <br />           <label class="col-sm-2 control-label place-holder-file-label"></label>           <div class="col-sm-10">             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"image":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-image-edit key="key" options="display.options" ng-disabled="display.readonly" model-data="data" ng-model="data[key]" class="field" />           </div>          <label class="col-sm-2 control-label"></label>           <div class="col-sm-10">             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"video":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-video-edit key="key" options="display.options" ng-disabled="display.readonly" model-data="data" ng-model="data[key]" class="field" />             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"datetime":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>           <div class="col-sm-10">             <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <p class="date-picker input-group">               <input type="text" class="form-control"               control="dateControl"              locale="{{ display.options.locale }}"              min-date="{{ display.minDate }}"               max-date="{{ display.maxDate }}"               ng-model="data[key]"               default-date="{{data[key]}}"               ng-format="display.options.format"               ng-time-zone="display.options.timeZone"               ng-view-mode="display.options.viewMode"               ng-required="{{ model.properties[key].required }}" ng-disabled="{{ display.readonly }}"               data-date-time-picker                />               <span class="input-group-btn">                 <button type="button" class="btn btn-default" ng-click="dateControl.show()" ng-disabled="{{ display.readonly }}"><i class="fa fa-calendar"></i></button>               </span>            </p>             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"multi-select":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10 multi-select">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-multi-select key="key" property="property" options="display.options" ng-disabled="display.readonly" model-data="data" ng-model="data[key]" class="field" />            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"select":var d="key as (value | translate) for (key, value) in display.options";b.property.display.options instanceof Array&&(d="object"!=typeof b.property.display.options[0]||Array.isArray(b.property.display.options[0])?"value as value for value in display.options":"item.key as item.value disable when item.disabled for item in display.options"),c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <select ng-model="data[key]" ng-options="'+d+'" ng-required="{{ model.properties[key].required }}" class="field form-control" ng-disabled="{{ display.readonly }}"><option value=""></option></select>            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"radio":var e="(value, text) in display.options";b.property.display.options instanceof Array&&(e="object"!=typeof b.property.display.options[0]||Array.isArray(b.property.display.options[0])?"text in display.options":"item in display.options"),c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10 multi-select">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <div class="select-item checkbox-container" ng-repeat="'+e+'" >              <input type="radio" ng-attr-id="{{key+\'-\'+$index}}" ng-model="data[key]" ng-value="value || text || item.key" ng-disabled="{{ display.readonly }}" name="{{key}}">              <label ng-attr-for="{{key+\'-\'+$index}}" class="radio">{{text || item.value}}</label>            </div>            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"slider":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <input slider ng-model="data[key]" options="display.options" class="slider ng-isolate-scope ng-valid ng-hide ng-dirty">             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"boolean":c='<div class="col-sm-2"></div>           <div class="col-sm-10 checkbox-container">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <input type="checkbox" ng-attr-id="{{key}}" ng-model="data[key]" ng-checked="check(data, key)" class="field" ng-disabled="{{ display.readonly }}">            <label class="checkbox-label" ng-attr-for="{{key}}">{{ display.label || key | translate }}</label>            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"password":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <input type="password" ng-model="data[key]" ng-pattern="display.pattern" ng-disabled="{{ display.readonly }}" ng-required="{{ model.properties[key].required }}" class="field form-control">            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"textarea":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <textarea msd-elastic ng-model="data[key]" ng-keyup="lengthCheck($event)" ng-disabled="{{ display.readonly }}" ng-required="{{ model.properties[key].required }}" class="field form-control" ng-maxlength="{{ display.maxLength }}"></textarea>            <div class="model-field-description">              <span ng-if="display.description"> {{ display.description | translate }} </span>               <span ng-if="display.maxLength"> &nbsp({{ charsLeft }} characters left) </span>            </div>          </div>';break;case"wysiwyg":case"WYSIWYG":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-wysiwyg-edit key="key" property="property" options="display.options" model-data="data" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required }}" ng-disabled="display.readonly"  />             <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"draw":case"signature":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-canvas-edit key="key" property="property" options="display.options" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required }}" ng-disabled="display.readonly"></model-field-canvas-edit>            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"location":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-location-edit key="key" property="property" options="display.options" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required }}" ng-disabled="display.readonly"></model-field-location-edit>            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"poi":case"POI":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-points-of-interest-edit key="key" property="property" options="display.options" ng-model="data[key]" class="field" ng-required="{{ model.properties[key].required }}" ng-disabled="display.readonly"></model-field-points-of-interest-edit>            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"number":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <model-field-number key="key" property="property" options="display.options" ng-required="model.properties[key].required" ng-disabled="display.readonly" model-data="data" ng-model="data[key]" ng-error="onFieldError(error)" class="field" />            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"phoneNumber":c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <input type="hidden" ng-model="countrycode" value="{{ display.region }}" />            <input type="text" ng-model="data[key]" phone-number country-code="countrycode" ng-pattern="display.pattern" ng-disabled="{{ display.readonly }}" ng-required="{{ model.properties[key].required }}" class="field form-control">            <div class="model-field-description" ng-if="display.description">{{ display.description | translate }}</div>          </div>';break;case"text":default:c='<label class="col-sm-2 control-label">{{ display.label || key | translate }}:</label>          <div class="col-sm-10">            <div class="error-message" ng-if="display.error.length > 0">{{ display.error }}</div>            <div ng-class="{\'input-status-indicator\': display.showStatusIndicator}">              <input type="text" ng-model="data[key]" ng-keyup="lengthCheck($event)" ng-pattern="display.pattern" ng-disabled="{{ display.readonly }}" ng-required="{{ model.properties[key].required }}" class="field form-control" ng-maxlength="{{ display.maxLength }}">              <div class="field-status-indicator" ng-if="display.showStatusIndicator">                <i class="fa" ng-class="{\'fa-check\': display.isValid && !display.isLoading, \'fa-warning\': !display.isValid && !display.isLoading, \'fa-spinner rotating\': display.isLoading}"></i>              </div>            </div>            <div class="model-field-description" ng-if="display.description || display.maxLength">              <span ng-if="display.description"> {{ display.description | translate }} </span>               <span ng-if="display.maxLength"> &nbsp({{ charsLeft }} characters left) </span>            </div>          </div>'}return c}function c(a,b){var c=$(a).find("input");if(b&&c)for(var d in b)c.attr(d,b[d])}return{restrict:"E",scope:{key:"=key",model:"=model",data:"=ngModel",ngError:"&"},link:function(d,e,f){function g(){d.key&&!d.data[d.key]&&(d.display.error="",d.ngError&&d.ngError({error:null}))}function h(a){a&&a.message?j.display.error=a.message:delete j.display.error,d.ngError&&d.ngError({error:a})}function i(){if("text"===j.display.type||"textarea"===j.display.type){var a=d.data[d.key]?d.data[d.key].length:0;d.charsLeft=j.display.maxLength-a,d.lengthCheck=function(a){return d.charsLeft=j.display.maxLength-a.target.value.length,j.display.maxLength&&a.target.value.length>j.display.maxLength?(d.display.error="Text is longer than the maximum allowed length of "+d.display.maxLength+" characters.",void(d.ngError&&d.ngError({error:new Error(d.display.error)}))):j.display.maxLength&&a.target.value.length<=j.display.maxLength&&a.target.value.length>0?(delete d.display.error,delete d.display.errorCode,void(d.ngError&&d.ngError({error:null}))):void(0===a.target.value.length&&j.display.isRequired&&(d.display.error="This is a required field.",d.ngError&&d.ngError({error:new Error(d.display.error)})))}}if("file"==j.display.type&&d.data[d.key]){var b=d.data[d.key];if("object"==typeof b&&b.filename?b=b.filename:"object"==typeof b&&b.file&&(b=b.file.name),b){var c=b.toLowerCase().substring(b.length-4);".png"!=c&&".jpg"!=c&&"jpeg"!=c&&".bmp"!=c||(j=angular.copy(j),j.display.type="image")}}"datetime"==j.display.type&&(j.display.options||(j.display.options={}),j.display.options.format||(j.display.options.format="YYYY-MM-DD  h:mm A")),!d.data[d.key]&&j.display.defaultValueUsingModelKey&&(d.data[d.key]=d.data[j.display.defaultValueUsingModelKey]),d.data[d.key]&&!1===j.display.convertToLocalTime&&(d.data[d.key]=d.data[d.key].substring(0,d.data[d.key].length-1)),"boolean"==j.display.type&&(d.check=function(a,b){var c=a[b];return void 0==c||null==c?j.display.default:(a[b]="1"==c||1==c,j.display.isRequired&&!d.data[d.key]?(d.display.error="This is a required field.",d.ngError&&d.ngError({error:new Error(d.display.error)})):(delete d.display.error,d.ngError&&d.ngError({error:null})),a[b])},"string"==typeof d.data[d.key]&&(d.data[d.key]=parseInt(d.data[d.key]))),"slider"==j.display.type&&(void 0!==d.data[d.key]&&null!=d.data[d.key]||(d.data[d.key]=j.display.options.from+";"+j.display.options.to))}var j;!function(){if(d.onFieldError=h,null!==d.key&&"object"==typeof d.key&&(d.model.properties[d.key.property]||(d.model.properties[d.key.property]={}),d.model.properties[d.key.property].display=d.key,d.key=d.key.property),j={display:{type:"text"}},d.model.properties&&d.model.properties[d.key]&&(j=d.model.properties[d.key]),!j)return void console.log("ModelField link error: no property for model '"+d.model.name+"'; property key = '"+d.key+"' found!")
;if(!j.display||!j.display.type)switch(j.display||(j.display={}),j.type){case"date":case"Date":j.display.type="datetime";break;default:j.display.type="text"}i(),d.data[d.key]||!j.default&&"number"!=typeof j.default||(d.data[d.key]=j.default),d.property=j,d.display=j.display,j.display.editTemplate?e.html(j.display.editTemplate).show():e.html(b(j.display.type,d)).show(),c(e,d.property.display.inputAttr),d.display.pattern&&"/"==d.display.pattern[0]&&"/"==d.display.pattern[d.display.pattern.length-1]&&(d.display.pattern=d.display.pattern.slice(1,d.display.pattern.length-2)),g(),a(e.contents())(d)}()}}}]),angular.module("dashboard.directives.ModelFieldCanvas",["dashboard.Dashboard.Model.Edit.SaveDialog","dashboard.Config","ui.bootstrap","dashboard.services.GeneralModel","ui.select"]).directive("modelFieldCanvasView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"disabled"},link:function(a,b,c){}}}]).directive("modelFieldCanvasEdit",["$compile","$cookies","$timeout","Config","FileUploadService",function(a,b,c,d,e){"ngInject";function f(){return'    <img ng-src="{{ data.fileUrl || data }}" crossOrigin="anonymous" class="disabled-div" ng-hide="!disabled"/></img>    <canvas ng-hide="disabled" ng-signature-pad="signature" width="300" height="150"></canvas>    <button ng-hide="disabled" class="btn btn-default" ng-click="clearCanvas()">Clear</button>  '}return{restrict:"E",require:"ngModel",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(b,c,d,e){b.isLoading=!0,b.signature={},b.clearCanvas=function(){var a=b.signature._canvas;a.width=a.width,b.data=null},b.$watch("signature._mouseButtonDown",function(){if(b.signature.fromDataURL&&b.isLoading){b.isLoading=!1;var a=new Image;a.setAttribute("crossOrigin","anonymous"),a.onload=function(){b.signature._canvas.getContext("2d").drawImage(a,0,0)},"object"==typeof b.data&&b.data.fileUrl?a.src=b.data.fileUrl:a.src=b.data}else if(b.signature.toDataURL){var c=b.signature.toDataURL();b.data=c}}),c.html(f()).show(),a(c.contents())(b)}}}]),angular.module("dashboard.directives.ModelFieldFile",["dashboard.services.GeneralModel"]).directive("modelFieldFileView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ field.label }}</b>: {{ data[field.name] }}",scope:{field:"=options",data:"=ngModel"},link:function(a,b,c){}}}]).directive("modelFieldFileEdit",["$compile","$document","$window","GeneralModelService","SessionService","$translate",function(a,b,c,d,e,f){"ngInject";return{restrict:"E",template:'<button class="btn btn-default select-file" ng-hide="disabled">{{ selectFileButtonText }}</button>       <input type="file" ng-file-select="onFileSelect($files)" ng-hide="disabled">       <button ng-if="filename" class="btn btn-danger fa fa-trash" ng-click="clear($event)" ng-hide="disabled"></button>       <span class="file-upload-info" ng-if="filename"><i class="fa {{getFileIcon(filename)}}"></i>&nbsp;&nbsp;{{ filename }}&nbsp;&nbsp;<span ng-if="fileUrl">(<a download href="{{fileUrl}}">download</a><span ng-if="previewUrl"> | <a target="_blank" href="{{previewUrl}}">preview</a></span>)</span></span>       <div ng-file-drop="onFileSelect($files)" ng-file-drag-over-class="optional-css-class-name-or-function" ng-show="dropSupported" class="file-drop">Drop File Here</div>',scope:{key:"=key",options:"=options",disabled:"=ngDisabled",data:"=ngModel",modelData:"=modelData"},link:function(a,c,d){a.selectFileButtonText="Select File",a.clearButtonText="Clear";var e=["button.select_file"];f(e).then(function(b){-1===e.indexOf(b["button.select_file"])&&(a.selectFileButtonText=b["button.select_file"])});var g=a.$watch("data",function(b){if(b)if(g(),a.data&&a.data&&a.data.filename)a.filename=a.data.filename,a.fileUrl=a.data.fileUrl,a.previewUrl=a.data.previewUrl;else if("string"==typeof a.data){a.fileUrl=a.data.replace(/%2F/g,"/");var c=a.fileUrl.indexOf("documents/");c<0?c=a.fileUrl.indexOf("documents%2F")+11:c+=9;var d=a.fileUrl.indexOf("?Expires");d<0&&(d=a.fileUrl.length),a.filename=a.fileUrl.substring(c+1,d)}else if("object"==typeof a.data.file){var e=a.options.path;a.data={path:e,file:a.data.file},a.filename=a.data.file.name,a.fileUrl=null,a.previewUrl=null}});a.getFileIcon=function(a){switch(a.substring(a.lastIndexOf(".")).toLowerCase()){case".txt":return"fa-file-text-o";case".doc":case".docx":return"fa-file-word-o";case".wav":case".mp3":case".aif":return"fa-file-audio-o";case".m4v":case".mov":case".mp4":case".avi":return"fa-file-video-o";case".jpg":case".jpeg":case".png":case".gif":case".bmp":case".tif":return"fa-file-image-o";case".xls":case".xlsx":return"fa-file-excel-o";case".ppt":case".pptx":return"fa-file-excel-o";case".pdf":return"fa-file-pdf-o";default:return"fa-file-o"}},a.onFileSelect=function(b){if(!(b.length<1)){var c=b[0],d=a.options.path;a.data={path:d,file:c},a.filename=c.name,a.fileUrl=null}},a.clear=function(b){b.preventDefault(),a.options.confirm&&!confirm("Are you sure you would like to clear the file?")||(a.data=null,a.filename=null,a.fileUrl=null)},b.on("drop",function(a){"INPUT"!=a.target.nodeName&&a.preventDefault()}),b.on("dragover",function(a){a.preventDefault(),c.find(".file-drop").addClass("show")}),$(window).on("mouseleave",function(){c.find(".file-drop").removeClass("show")}),a.$on("$destroy",function(){b.off("drop"),b.off("dragover"),$(window).off("mouseleave")})}}}]),angular.module("dashboard.directives.ModelFieldImage",["dashboard.services.GeneralModel","dashboard.services.Image"]).directive("modelFieldImageView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ field.label }}</b>: {{ data[field.name] }}",scope:{field:"=options",data:"=ngModel"},link:function(a,b,c){}}}]).directive("modelFieldImageEdit",["$compile","$document","GeneralModelService","ImageService","SessionService","$timeout","$translate",function(a,b,c,d,e,f,g){"ngInject";return{restrict:"E",require:"^form",template:'<div class="image-container" style="background: no-repeat center center url(\'{{ thumbnailUrl }}\'); background-size: contain;" ng-click="imageClick()"></div>       <div class="button-menu show-menu">      <button class="btn btn-default upload-button" ng-hide="disabled">{{ selectFileButtonText }}</button>       <button class="btn btn-default clear-button" ng-show="imageUrl && !disabled" ng-click="clear()">{{ clearButtonText }}</button>       </div>       <div ng-file-drop="onFileSelect($files)" ng-file-drag-over-class="optional-css-class-name-or-function" ng-show="dropSupported && !disabled" class="image-drop">{{ uploadStatus }}</div>       <div ng-file-drop-available="dropSupported=true" ng-show="!dropSupported">HTML5 Drop File is not supported!</div>       <input type="file" ng-file-select="onFileSelect($files)" ng-hide="disabled">       <button ng-click="upload.abort()" class="cancel-button">Cancel Upload</button>',scope:{key:"=key",options:"=options",disabled:"=ngDisabled",data:"=ngModel",modelData:"=modelData"},link:function(a,e,h,i){var j=null;a.selectFileButtonText="Select File",a.clearButtonText="Clear";var k=["button.select_file","button.clear"];g(k).then(function(b){-1===k.indexOf(b["button.select_file"])&&(a.selectFileButtonText=b["button.select_file"]),-1===k.indexOf(b["button.clear"])&&(a.clearButtonText=b["button.clear"])}),a.uploadStatus="Upload File";var l=a.$watch("data",function(b){if(b)if(l(),a.options&&a.options.model)c.get(a.options.model,b).then(function(b){b&&(a.imageUrl=b[a.options.urlKey],a.imageUrl||(a.imageUrl=b.mediumUrl),a.thumbnailUrl=a.imageUrl)});else if("string"==typeof b)if(a.imageUrl=b,a.thumbnailUrl=a.options.thumbnailUrl,a.thumbnailUrl){var d=new Image;d.onerror=function(){f(function(){a.thumbnailUrl=a.imageUrl})},d.src=a.thumbnailUrl}else a.thumbnailUrl=a.imageUrl;else"object"==typeof b&&(b.fileUrl&&(a.imageUrl=b.fileUrl),b.imageUrl&&(a.imageUrl=b.imageUrl),!a.imageUrl&&b.file&&(j=b.file,m.readAsDataURL(b.file)))}),m=new FileReader;m.onload=function(b){var c=a.options.path,e={path:c,file:j};a.modelData.__ModelFieldImageData||(a.modelData.__ModelFieldImageData={}),a.options&&a.options.urlKey?(a.modelData.__ModelFieldImageData[a.key]||(a.modelData.__ModelFieldImageData[a.key]={}),a.modelData.__ModelFieldImageData[a.key][a.options.urlKey]=e):a.modelData.__ModelFieldImageData[a.key]=e,i.$setDirty(),d.fixOrientationWithDataURI(b.target.result,function(b,c){a.imageUrl=c,a.thumbnailUrl=c,e.file=a.dataURItoBlob(c),e.file.name=j.name,a.options&&a.options.export?(a.uploadStatus="Creating Image Sizes",a.exportImages(function(){a.uploadStatus="Upload File",a.$apply()})):a.options&&a.options.resize&&a.resizeImage(c,a.options.resize,function(a){e.file=a}),a.$apply()})},m.onerror=function(a){console.log(a)},a.clear=function(){a.options.confirm&&!confirm("Are you sure you would like to clear this photo?")||(a.data=null,a.modelData.__ModelFieldImageData&&a.modelData.__ModelFieldImageData[a.key]&&delete a.modelData.__ModelFieldImageData[a.key],delete a.imageUrl,delete a.thumbnailUrl,i.$setDirty())},a.onFileSelect=function(b){if(!(b.length<1)){j=b[0];var c=!1;a.options.extensions?a.options.extensions.forEach(function(a){j.type.match("image/"+a)&&(c=!0)}):c=!0,c?m.readAsDataURL(j):alert("File must be of the following file types ("+a.options.extensions.join(", ")+").")}},a.exportImages=function(b){var c=arguments[1];c||(c=0);var d=Object.keys(a.options.export);if(c>=d.length)return void b();var e=d[c],f=a.options.export[e];a.resizeImage(a.imageUrl,f,function(d){a.modelData.__ModelFieldImageData[a.key][e]=d,c++,a.exportImages(b,c)})},a.resizeImage=function(b,c,e){d.resize(b,c,function(b,c){var d=a.dataURItoBlob(c);e(d)})},a.dataURItoBlob=function(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},a.imageClick=function(){if(a.options&&a.options.isLightbox||a.options.isLightboxWithZoom){var b=new Image;b.onload=function(){var c=$('<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color:rgba(0,0,0,0); z-index: 9999;"></div>'),d=$('<div style="position: absolute; top: 5%; left: 5%; right: 5%; bottom: 5%; opacity: 0.0; cursor: pointer;"></div>');if(c.append(d),$("body").append(c),a.options.isLightbox){var e=Math.min(d.width()/b.width,d.height()/b.height),f=b.width*e,g=b.height*e;d.css({background:"no-repeat center center url("+a.imageUrl+")",backgroundSize:f+"px "+g+"px"})}else{var h=$('<div style="display: inline-block; width: 30%; height: 100%;"></div>'),i=$('<div style="display: inline-block; width: 70%; height: 100%;"></div>');d.append(h),d.append(i);var e=Math.min(h.width()/b.width,h.height()/b.height),j=b.width*e,k=b.height*e;h.css({background:"no-repeat center center url("+a.imageUrl+")",backgroundSize:j+"px "+k+"px"});e=1;var l=b.width*e,m=b.height*e;i.css({background:"no-repeat center center url("+a.imageUrl+"), #111",backgroundSize:l+"px "+m+"px",border:"solid 1px #000"});var n="center",o="center",p=function(a){n=a.offsetX,o=a.offsetY,n||(n=a.pageX),o||(o=a.pageY),n-=h.width()/2-j/2,o-=h.height()/2-k/2,n*=-l/j,o*=-m/k,n+=i.width()/2,o+=i.height()/2,i.css({backgroundPosition:n+"px "+o+"px",backgroundSize:l+"px "+m+"px"})};h.on("mousemove",p),h.bind("mousewheel",function(a){a.originalEvent.wheelDelta/120>0&&e+.01<=1.1?e+=.01:e-.01>=.1&&(e-=.01),l=b.width*e,m=b.height*e,p(a)})}c.animate({backgroundColor:"rgba(0,0,0,0.65)"},600,function(){d.animate({opacity:1},300)}),d.click(function(){c.animate({opacity:0},300,function(){c.remove()})})},b.src=a.imageUrl}else{var c=e.find(".image-container");c.width()<=160?c.animate({width:"400px",height:"400px"},300):c.animate({width:"160px",height:"160px"},300)}},b.on("drop",function(a){"INPUT"!=a.target.nodeName&&a.preventDefault()}),b.on("dragover",function(a){a.preventDefault(),e.find(".image-drop").addClass("show-upload"),e.find(".input[type=file]").addClass("show-upload"),e.find(".button-menu").addClass("hide-menu")}),$(window).on("mouseleave",function(){e.find(".image-drop").removeClass("show-upload"),e.find(".input[type=file]").removeClass("show-upload"),e.find(".button-menu").removeClass("hide-menu")}),a.$on("$destroy",function(){b.off("drop"),b.off("dragover"),$(window).off("mouseleave")})}}}]),angular.module("dashboard.directives.ModelFieldList",["dashboard.Config","dashboard.services.GeneralModel","ui.select"]).directive("modelFieldListView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"ngDisabled"},link:function(a,b,c){}}}]).directive("modelFieldListEdit",["$compile","$cookies","$timeout","Config","GeneralModelService",function(a,b,c,d,e){"ngInject";function f(a){return'    <ul ui-sortable="sortableOptions" ng-model="list" ng-show="list.length > 0">       <li ng-repeat="(index, item) in list">         <i class="fa fa-reorder"></i>        <div class="list-field-container">           <div class="list-field" ng-repeat="field in options.display">            <input type="text" class="form-control list-edit-{{field}}" ng-model="list[index][field]" placeholder="{{options.properties[field].display.label}}", ng-change="updateData()" ng-disabled="disabled || list[index].isDisabled">           </div>         </div>         <div class="action">           <a href="" ng-click="removeItem(index)" class="remove" ng-hide="disabled || list[index].isDisabled"><i class="fa fa-times"></i></a>         </div>       </li>     </ul>    <button class="btn btn-default list-add-item" ng-click="addItem()" ng-disabled="disabled">{{ options.addLabel }}</button>'}return{restrict:"E",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(b,c,d){b.list||(b.list=[]),b.options.addLabel||(b.options.addLabel="Add Item"),b.sortableOptions={placeholder:"sortable-placeholder",update:self.updateData,disabled:b.disabled},b.setData=function(){"object"==b.options.output?b.data=b.list:b.data=JSON.stringify(b.list)},b.addItem=function(){event.preventDefault(),b.list.push({}),b.setData()},b.removeItem=function(a){b.list[a];b.list.splice(a,1),b.setData()},b.updateData=function(){b.setData()};b.$watchCollection("[data, options, modelData]",function(a){if(b.data&&b.options)if(b.data instanceof Array)b.list=b.data;else try{b.list=JSON.parse(b.data)}catch(a){b.list=[],console.error("ModelFieldList failed to parse scope.data",a)}});c.html(f(b.options.key)).show(),a(c.contents())(b)}}}]),angular.module("dashboard.directives.ModelFieldLocation",["dashboard.services.Location","ui.bootstrap","dashboard.services.GeneralModel"]).directive("modelFieldLocationView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"disabled"},link:function(a,b,c){}}}]).directive("modelFieldLocationEdit",["$compile","$q","LocationService",function(a,b,c){"ngInject";function d(){var a=b.defer();if(angular.element("#google_maps").length)return a.resolve(),a.promise;var c=document.createElement("script");return c.onload=function(){a.resolve()},c.id="google_maps",c.type="text/javascript",c.src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,places",document.getElementsByTagName("head")[0].appendChild(c),a.promise}function e(){return'       <div class="loading" ng-if="isMapLoading"><img src="http://www.nasa.gov/multimedia/videogallery/ajax-loader.gif" width="20" height="20" />Loading your location...</div>       <div ng-show="isLoaded">         <div class="row">          <div class="cols" ng-class="{\'col-sm-5\':valueChanged,\'col-sm-6\':!valueChanged}">            <input id="geoPointLat" class="field form-control" placeholder="Lat" ng-model="data.lat">          </div>          <div class="cols" ng-class="{\'col-sm-5\':valueChanged,\'col-sm-6\':!valueChanged}">            <input id="geoPointLng" class="field form-control" placeholder="Lng" ng-model="data.lng">          </div>          <div class="cols col-sm-2" ng-show="valueChanged">            <button class="btn" ng-click="revertValue()" ng-disabled="!valueChanged">Revert</button>          </div>        </div>        <div class="map-canvas" id="map_canvas"></div>        <accordion close-others="oneAtATime" ng-if="showGeocode">          <accordion-group heading="Geocode">            <input class="field form-control" placeholder="Location" ng-model="geocodeSearch.value">            <div ng-if="geocodeError">{{geocodeError}}</div>            <button class="btn" ng-click="doGeocode()" ng-disabled="!geocodeSearch.value">Go</button>          </accordion-group>        </accordion>      </div>'}return{restrict:"E",require:"ngModel",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(b,f,g){function h(){b.isMapLoading=!1,b.isLoaded=!0,k=new google.maps.Map(angular.element("#map_canvas")[0],{center:b.location,zoom:12}),i()}function i(){j()}function j(){if(b.data)if(m){var a=new google.maps.LatLng(b.data.lat,b.data.lng);m.setPosition(a),m.setMap(k),k.setCenter(a)}else{m=new google.maps.Marker({position:b.location,map:k,icon:new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|2F76EE",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),draggable:!0,tooltip:"Current location"}),google.maps.event.addListener(m,"dragend",function(){var a={lat:m.position.lat(),lng:m.position.lng()};b.data=a,b.$digest()})}}var k,l,m,n;b.isMapLoading=!0,b.isLoaded=!1,b.geocodeSearch={value:""},b.geocodeError=null,b.showGeocode=!1,d().then(function(){l=new google.maps.Geocoder,b.showGeocode=!1,b.property.display.options&&b.property.display.options.allowGeocode&&(b.showGeocode=!0);b.property.display.options&&b.property.display.options.query&&b.property.display.options.query,f.html(e()).show(),a(f.contents())(b),b.data?(n=b.data,b.location=angular.copy(b.data),h()):c.currentLocation().then(function(a){var c={lat:a.latitude,lng:a.longitude};n=c,b.data=c,h()}),b.$watch("data",function(a,c){a!=c&&(b.valueChanged=JSON.stringify(b.data)!=JSON.stringify(n),j())}),b.$watch("data.lat",function(a,c){a!=c&&(b.valueChanged=JSON.stringify(b.data)!=JSON.stringify(n),j())}),b.$watch("data.lng",function(a,c){a!=c&&(b.valueChanged=JSON.stringify(b.data)!=JSON.stringify(n),j())})},function(){console.error("Error loading Google Maps")}),b.doGeocode=function(){b.geocodeError=null,b.geocodeSearch.value?l.geocode({address:b.geocodeSearch.value},function(a,c){c==google.maps.GeocoderStatus.OK?b.$apply(function(){var c={lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng()};b.data=c,h()}):c===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?console.log("Geocode was not successful for the following reason: "+c):c===google.maps.GeocoderStatus.ZERO_RESULTS?(b.geocodeError="Couldn't match the specified query with a geopoint",b.$digest(),console.log("Geocode was not successful for the following reason: "+c)):console.log("Geocode was not successful for the following reason:"+c)}):alert("Please enter the address of a location to geocode.")},b.clearSearch=function(){b.hasSearched=!1},b.revertValue=function(){n&&(b.data=n)}}}}]),angular.module("dashboard.directives.ModelFieldMultiSelect",[]).directive("modelFieldMultiSelect",["$compile",function(a){"ngInject";function b(){return'<div class="select-item checkbox-container" ng-repeat="item in multiSelectOptions"><input type="checkbox" class="field" ng-attr-id="{{key+\'-\'+$index}}" ng-model="selected[$index]" ng-checked="selected[$index]" ng-disabled="disabled" ng-change="clickMultiSelectCheckbox($index, item)"><label class="checkbox-label" ng-attr-for="{{key+\'-\'+$index}}">{{ item.value }}</label></div>'}return{restrict:"E",require:"ngModel",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(c,d,e,f){function g(){var a=c.options||j.display.options;"string"==typeof a&&(a=a.indexOf("\n")>-1?a.split("\n"):a.split(","));var b=j.display.key||"key",d=j.display.value||"value";if(Array.isArray(a))for(var e in a){var f=a[e];if("string"==typeof f){var g={key:f,value:f};c.multiSelectOptions.push(g)}else if(f&&"object"==typeof f){var h=f[b]||e,g={key:h,value:f[d],item:f};c.multiSelectOptions.push(g)}}else if(a&&"object"==typeof a){var i=Object.keys(a);for(var k in i){var h=i[k],g={key:h,value:a[h]};c.multiSelectOptions.push(g)}}}function h(){if(void 0===j.display.output){var a=c.options||j.display.options;j.display.output=a instanceof Array?"comma":"object"}if("string"==typeof c.data){c.data||(c.data="");var b=c.data.split('","');for(var d in b){var e=b[d];'"'==e[0]&&(e=e.substring(1,e.length)),'"'==e[e.length-1]&&(e=e.substring(0,e.length-1));var f=_.findIndex(c.multiSelectOptions,{key:e});f>-1&&(c.selected[f]=!0)}}else if(Array.isArray(c.data)){c.data||(c.data=[]);for(var d in c.data){var g=c.data[d],f=_.findIndex(c.multiSelectOptions,{key:g});f>-1&&(c.selected[f]=!0)}}else if(c.data&&"object"==typeof c.data){c.data||(c.data={});var h=Object.keys(c.data);for(var i in h){var k=h[i],f=_.findIndex(c.multiSelectOptions,{key:k});f>-1&&(c.selected[f]=!0)}}}function i(a,b){var d="array"===j.display.output?[]:"object"===j.display.output?{}:"";for(var e in c.selected)if(c.selected[e]){var f=c.multiSelectOptions[e];switch(j.display.output){case"object":d[f.key]=f.value;break;case"comma":d+='"'+f.key+'",';break;case"array":d.push(b.item||b.key)}}"comma"===j.display.output&&d.length>0&&(d=d.substring(0,d.length-1)),c.data=d}var j=c.property;!function(){c.multiSelectOptions=[],c.selected=[],j||(j={}),j.display||(j.display={}),g(),h(),c.clickMultiSelectCheckbox=i,d.html(b()).show(),a(d.contents())(c)}()}}}]),angular.module("dashboard.directives.ModelFieldNumber",[]).directive("modelFieldNumber",["$compile","$filter",function(a,b){"ngInject";function c(){return'<input type="{{property.display.allowDecimal ? \'text\' : \'number\'}}" ng-class="{error: property.display.error.length > 0}" ng-keypress="checkNumber($event)" ng-blur="validateAndParseNumbers($event)" min="{{ property.display.minValue }}" max="{{ property.display.maxValue }}" ng-model="data" ng-disabled="disabled" ng-required="required" class="field form-control">'}return{restrict:"E",require:"ngModel",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled",required:"=ngRequired",ngError:"&"},link:function(d,e,f,g){function h(a){var b=0;if(document.selection){var c=document.selection.createRange();c.moveStart("character",-a.target.value.length),b=c.text.length}else(a.target.selectionStart||0===a.target.selectionStart)&&(b=a.target.selectionStart);var d=a.target.value;if("string"==typeof d){var e=d.indexOf(".");if(!(-1===e||e>=b)){var f=d.split(".");if(!(f.length<1))return f[1].length>=k.display.scaleValue?void a.preventDefault():void 0}}}function i(a){if((""===a.target.value||null===a.target.value)&&!a.target.validity.badInput)return void(d.ngError&&k.display.isRequired?d.ngError({error:new Error("This is a required field.")}):d.ngError&&d.ngError({error:null}));if(!0===k.display.allowDecimal){var c=b("decimalWithScale")(a.target.value,k.display.scaleValue);if(isNaN(c)&&d.ngError)return void d.ngError({error:new Error("Please enter a valid number")});if(d.data=c,void 0!==k.display.minValue&&j(k.display.minValue,a.target.value))return void(d.ngError&&d.ngError({error:new Error("Value is less than the minimum allowed value ("+k.display.minValue+").")}));if(void 0!==k.display.maxValue&&j(a.target.value,k.display.maxValue))return void(d.ngError&&d.ngError({error:new Error("Value is greater than the maximum allowed value ("+k.display.maxValue+").")}));d.ngError&&d.ngError({error:null})}else if(!1===k.display.allowDecimal){if(isNaN(_.round(a.target.value))||isNaN(parseInt(a.target.value)))return void(d.ngError&&d.ngError({error:new Error("Please enter a valid number")}));var e=_.round(a.target.value,0);if(d.data=e,void 0!==k.display.minValue&&k.display.minValue>parseFloat(a.target.value))return void(d.ngError&&d.ngError({error:new Error("Value is less than the minimum allowed value ("+k.display.minValue+").")}));if(void 0!==k.display.maxValue&&k.display.maxValue<parseFloat(a.target.value))return void(d.ngError&&d.ngError({error:new Error("Value is greater than the maximum allowed value ("+k.display.maxValue+").")}));d.ngError&&d.ngError({error:null})}}function j(a,c){if(a=b("decimalWithScale")(a,k.display.scaleValue),c=b("decimalWithScale")(c,k.display.scaleValue),!isNaN(a)&&!isNaN(c)){var d=a.split("."),e=c.split(".");if(parseInt(d[0])>parseInt(e[0]))return!0;if(parseInt(d[0])<parseInt(e[0]))return!1;for(var f=parseInt(d[0])>=0&&parseInt(e[0])>=0,g=0;g<Math.max(d[1].length,e[1].length);g++){if(""===d[1].charAt(g)&&(d[1]+="0"),""===e[1].charAt(g)&&(e[1]+="0"),parseInt(d[1].charAt(g))>parseInt(e[1].charAt(g)))return f;if(parseInt(d[1].charAt(g))<parseInt(e[1].charAt(g)))return!f}}}var k=d.property;!function(){k||(k={}),k.display||(k.display={}),void 0===k.display.scaleValue&&(k.display.scaleValue=0),d.checkNumber=h,d.validateAndParseNumbers=i,!0===k.display.allowDecimal&&(d.data=b("decimalWithScale")(d.data,k.display.scaleValue)),e.html(c()).show(),a(e.contents())(d)}()}}}]),angular.module("dashboard.directives.ModelFieldPointsOfInterest",["dashboard.Dashboard.Model.Edit.SaveDialog","dashboard.Config","dashboard.services.Location","ui.bootstrap","dashboard.services.GeneralModel","ui.select"]).directive("modelFieldPointsOfInterestView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"disabled"},link:function(a,b,c){}}}]).directive("modelFieldPointsOfInterestEdit",["$compile","$cookies","$timeout","$http","$q","$window","Config","GeneralModelService","LocationService",function(a,b,c,d,e,f,g,h,i){"ngInject";function j(a){var b=e.defer();if(angular.element("#google_maps").length)return b.resolve(),b.promise;var c=document.createElement("script");return c.onload=function(){b.resolve()},c.id="google_maps",c.type="text/javascript",c.src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,places",a&&(c.src+="&key="+a),document.getElementsByTagName("head")[0].appendChild(c),b.promise}function k(a){return a.replace(/ /g,"_").toLowerCase()}function l(){return' \t\t\t<div class="loading" ng-if="isMapLoading"><i class="fa fa-spin fa-spinner"></i>Search results are loading...</div> \t\t\t<div ng-show="isLoaded"> \t\t\t<accordion close-others="oneAtATime"> \t\t\t<accordion-group class="accordion-group" heading="Location Search" is-open="true"> \t\t\t<input id="zipCode" class="field form-control" placeholder="Zip Code" ng-model="data.zipCode">\t\t\t<input id="searchInput" class="field form-control" placeholder="Search Location" ng-model="request[\'query\']">\t\t\t <select id="radius" ng-model="data.radius" ng-required="" class="field form-control ng-pristine ng-valid ng-valid-required" ng-disabled=""> \t\t\t\t <option value="1" label="1 Mile">1 Mile</option> \t\t\t\t <option value="2" label="2 Miles">2 Miles</option> \t\t\t\t <option value="3" label="3 Miles" selected>3 Miles</option> \t\t\t\t <option value="5" label="5 Miles">5 Miles</option> \t\t\t\t <option value="10" label="10 Miles">10 Miles</option> \t\t\t\t <option value="20" label="20 Miles">20 Miles</option> \t\t\t\t <option value="30" label="30 Miles">30 Miles</option> \t\t\t </select> \t\t\t<button class="btn btn-default" ng-click="doSearch()" ng-model="request.query">Search</button><span class="search-error" ng-if="searchError">{{searchError}}</span>\t\t\t</accordion-group>\t\t\t</accordion> \t\t\t<div class="map-canvas"id="map_canvas"></div> \t\t\t<ul class="selected-location" ng-model="displayedSearchResults" > \t\t\t\t<li ng-repeat="item in displayedSearchResults track by item.id" ng-click="updateSelection($index, displayedSearchResults)"> \t\t\t\t\t<div class="location-title">{{ $index + 1 }}. {{ item.name }}</div> \t\t\t\t\t\t<span class="search-results">{{item.formatted_address}}</span> \t\t\t\t\t<div class="col-sm checkbox-container">\t\t\t\t\t\t<input type="checkbox" ng-attr-id="{{item.place_id}}" ng-model="item.checked" class="field"> \t\t\t\t\t\t<label class="checkbox-label" ng-attr-for="{{item.place_id}}" ></label> \t\t\t\t\t</div> \t\t\t\t</li> \t\t\t</ul>'}return{restrict:"E",require:"ngModel",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(b,c,d){function e(){b.isMapLoading=!1,b.isLoaded=!0,q=new google.maps.Map(document.getElementById("map_canvas"),{center:b.request.location,zoom:s}),f()}function f(){g()}function g(){b.clearSearch();var a=jQuery.extend(!0,{},b.request);a.radius=.5*a.radius,new google.maps.places.PlacesService(q).textSearch(a,function(a,c){c==google.maps.places.PlacesServiceStatus.OK?(h(a),b.boundaries.length>0&&p(),b.markers.length>0&&i(),m(),n(),o(),b.$digest()):console.log("search was not successful for the following reason: "+c)})}function h(a){u&&u.close();for(var c=0;c<a.length;c++){b.searchResults.push(a[c]);var d="Location:  "+a[c].name,e=new google.maps.Marker({map:q,position:a[c].geometry.location});google.maps.event.addListener(e,"click",function(a,c){return function(){t=a.getPosition(),u.setContent(c),u.open(q,a),b.getClickedMarker(t)}}(e,d)),b.markers.push(e)}}function i(){for(var a=0;a<b.markers.length;a++)b.markers[a].setMap(null)}function m(){b.circle=new google.maps.Circle({center:b.request.location,radius:b.request.radius,fillOpacity:.15,fillColor:"#FF0000",map:q}),b.boundaries.push(b.circle)}function n(){for(var a=new google.maps.LatLngBounds,c=0;c<b.markers.length;c++){var d=b.markers[c];google.maps.geometry.spherical.computeDistanceBetween(d.getPosition(),b.circle.center)<b.request.radius?(a.extend(d.getPosition()),b.displayedMarkers.push(d),d.setMap(q)):d.setMap(null)}q.fitBounds(a),0==b.displayedMarkers.length&&(b.searchError="Couldn't find any locations matching the search criteria!")}function o(){for(var a=0;a<b.searchResults.length;a++){var c=b.searchResults[a];google.maps.geometry.spherical.computeDistanceBetween(c.geometry.location,b.circle.center)<b.request.radius&&b.displayedSearchResults.push(c)}b.data.placeId&&(w=new google.maps.LatLng(b.data.lat,b.data.lng),b.getClickedMarker(w))}function p(){for(var a=0;a<b.boundaries.length;a++)b.boundaries[a].setMap(null),b.boundaries.length=0}var q,r,s,t,u,v,w;if(b.circle={},b.markers=[],b.boundaries=[],b.searchResults=[],b.displayedMarkers=[],b.displayedSearchResults=[],b.isMapLoading=!0,b.isLoaded=!1,b.placeType=b.property.display.options.placeType,b.googleApiKey=b.property.display.options.googleApiKey,b.googleType=[k(b.placeType)],b.data||(b.data={}),b.property.display.zipCode&&(b.data.zipCode=b.property.display.zipCode),b.data&&"string"==typeof b.data)try{b.data=JSON.parse(b.data)}catch(a){console.error(a),b.data={}}b.data.radius||(b.data.radius=3),j(b.googleApiKey).then(function(){console.log("scope.data",b.data),r=new google.maps.Geocoder,u=new google.maps.InfoWindow,v=b.data.query?b.data.query:b.placeType,b.request={radius:3*1609.34,query:v,type:b.googleType},c.html(l()).show(),a(c.contents())(b),b.isMapLoading=!1,b.isLoaded=!0,b.doSearch()},function(){console.error("Error loading Google Maps")}),b.doSearch=function(){b.searchError=null,b.data.query=b.request.query,b.request.radius=1609.34*b.data.radius;var a=b.data.zipCode
;a&&5===a.length?(r=new google.maps.Geocoder,r.geocode({address:a},function(a,c){c==google.maps.GeocoderStatus.OK?b.$apply(function(){var c={lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng()};b.request.location=c,b.reverseGeocode(c),e()}):c===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?console.log("search was not successful for the following reason: "+c):console.log("search was not successful for the following reason:"+c)})):b.searchError="Your Zip Code is invalid!"},b.reverseGeocode=function(a){r=new google.maps.Geocoder,r.geocode({location:a},function(a,c){if(c===google.maps.GeocoderStatus.OK)if(a[0]){var d={placeId:a[0].place_id};b.getAdditionPlaceInformation(d)}else console.log("search was not successful for the following reason: "+c);else console.log("search was not successful for the following reason: "+c)})},b.getClickedMarker=function(a){if(b.displayedSearchResults){for(var c=0;c<b.displayedSearchResults.length;c++)0==google.maps.geometry.spherical.computeDistanceBetween(a,b.displayedSearchResults[c].geometry.location)?(b.displayedSearchResults[c].checked=!0,b.getSelectResultData(b.displayedSearchResults[c])):b.displayedSearchResults[c].checked=!1;b.$digest()}},b.clearSearch=function(){i(),p(),b.searchResults=[],b.displayedMarkers=[],b.displayedSearchResults=[],b.markers=[]},b.getAdditionPlaceInformation=function(a){service=new google.maps.places.PlacesService(q),service.getDetails(a,function(a,c){if(c==google.maps.places.PlacesServiceStatus.OK){if(a.address_components)for(var d=0;d<a.address_components.length;d++)"postal_code"==a.address_components[d].types[0]&&(b.data.zipCode=a.address_components[d].short_name);b.data.phoneNumber=a.formatted_phone_number}else console.log("The selection made does not exist")})},b.getSelectResultData=function(a){if(a){var c={placeId:a.place_id};b.data.address=a.formatted_address,b.data.lat=a.geometry.location.lat(),b.data.lng=a.geometry.location.lng(),b.data.name=a.name,b.data.placeId=c.placeId,b.getAdditionPlaceInformation(c)}},b.updateInfoWindow=function(a){var b="Location:  "+a.name,c=new google.maps.Marker({map:q,position:a.geometry.location});u.setContent(b),u.open(q,c)},b.updateSelection=function(a,c){angular.forEach(c,function(c,d){a!=d?c.checked=!1:(c.checked=!0,b.updateInfoWindow(c),b.getSelectResultData(c))})}}}}]),angular.module("dashboard.directives.ModelFieldReference",["dashboard.Config","dashboard.services.GeneralModel","ui.select"]).directive("modelFieldReferenceView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"ngDisabled"},link:function(a,b,c){}}}]).directive("modelFieldReferenceEdit",["$compile","$cookies","Config","GeneralModelService",function($compile,$cookies,Config,GeneralModelService){"ngInject";function getTemplate(a,b,c){return a?'      <ui-select multiple ng-model="selected.items" on-select="onSelect($item, $model)" on-remove="onRemove($item, $model)"  ng-disabled="disabled">       <ui-select-match placeholder="{{ options.placeholder }}">'+b+'</ui-select-match>       <ui-select-choices repeat="item in list" refresh="refreshChoices($select.search)" refresh-delay="200">'+c+"</ui-select-choices>       </ui-select>":'      <ui-select ng-model="selected.item" on-select="onSelect($item, $model)" ng-required="ngRequired" ng-disabled="disabled" append-to-body="{{appendToBody}}">       <ui-select-match ng-click="refreshChoices($select.search);" placeholder="{{ options.placeholder }}">'+b+'</ui-select-match>       <ui-select-choices repeat="item in list" refresh="refreshChoices($select.search)" refresh-delay="200">'+c+"</ui-select-choices>       </ui-select>"}return{restrict:"E",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled",rowData:"=ngRowData",textOutputPath:"=ngTextOutputPath",onModelChanged:"&onModelChanged",appendToBody:"=appendToBody"},link:function(scope,element,attrs){function replaceSessionVariables(string){if("string"!=typeof string)return string;try{for(var session=JSON.parse($cookies.get("session")),searchString="{session.",startPos=string.indexOf(searchString);startPos>-1;){var endPos=string.indexOf("}",startPos);if(-1==endPos){console.error("ModelList session parsing malformed for string");break}var sessionKey=string.substring(startPos+1,endPos);string=string.slice(0,startPos)+eval(sessionKey)+string.slice(endPos+1),startPos=string.indexOf(searchString)}for(searchString="{",startPos=string.indexOf(searchString);startPos>-1;){var endPos=string.indexOf("}",startPos);if(-1==endPos){console.error("ModelList session parsing malformed for string");break}var key=string.substring(startPos+1,endPos);string=string.slice(0,startPos)+scope.modelData[key]+string.slice(endPos+1),startPos=string.indexOf(searchString)}}catch(a){console.error(a)}return string}function mergeArray(a,b){for(var c in a){var d=a[c];-1==b.indexOf(d)&&b.push(d)}}function assignJunctionMeta(){if(scope.options.junctionMeta)for(var a in scope.selected.items){var b=scope.selected.items[a];b.junctionMeta=scope.options.junctionMeta}}scope.moment=moment,scope.isFirstTimeLoad=!0,scope.selected={},scope.selected.items=[],scope.selected.item=null,scope.list=[],scope.$watch("selected",function(a,b){var c=element.hasClass("ng-invalid"),d=scope.options&&scope.options.multiple?a.items:a.item,e=scope.options&&scope.options.multiple?b.items:b.item;!d||d.length<=0?scope.property&&(scope.property.required||scope.property.display&&scope.property.display.required)&&element.addClass("ng-invalid"):c&&element.removeClass("ng-invalid"),d=_.isPlainObject(d)&&d[scope.options.key]?d[scope.options.key]:d,e=_.isPlainObject(e)&&e[scope.options.key]?e[scope.options.key]:e,scope.$emit("onModelFieldReferenceChange",scope.options.relationship?scope.options.relationship:scope.key,d,e)},!0),scope.refreshChoices=function(a){var b=Config.serverParams.models[scope.options.model],c={"filter[limit]":100};if(c["filter[where]["+scope.options.searchField+"][like]"]="%"+a+"%",scope.options.where){var d=Object.keys(scope.options.where);for(var e in d){var f=d[e];c["filter[where]["+f+"]"]=replaceSessionVariables(scope.options.where[f])}}if(scope.options.filters){var d=Object.keys(scope.options.filters);for(var e in d){var f=d[e];c[f]=replaceSessionVariables(scope.options.filters[f])}}var g=b.plural;scope.options.api&&(g=replaceSessionVariables(scope.options.api)),GeneralModelService.list(g,c,{preventCancel:!0}).then(function(a){if(a){if(scope.list=a,scope.options.allowInsert){var b={};b[scope.options.searchField]="[Add New Item]",scope.list.push(b)}if(scope.options.allowClear){var b={};b[scope.options.searchField]="[clear]",scope.list.unshift(b)}"number"==typeof scope.options.defaultIndex&&a[scope.options.defaultIndex]&&scope.onSelect(a[scope.options.defaultIndex])}})};var unwatch=scope.$watchCollection("[data, options, modelData]",function(a){if(scope.modelData&&scope.modelData&&scope.options&&scope.options.multiple){if(!scope.property.display.sourceModel)return unwatch(),void(scope.modelData[scope.property.display.options.relationship]&&(scope.selected.items=scope.modelData[scope.property.display.options.relationship],assignJunctionMeta(),scope.list=scope.selected.items));var b=Config.serverParams.models[scope.property.display.sourceModel],c=Config.serverParams.models[scope.options.model],d=b.plural,e=(c.plural,scope.modelData[scope.property.display.sourceKey]);if(!e)return;unwatch();var f={};if(scope.options.junctionMeta){var g=Object.keys(scope.options.junctionMeta);for(var h in g){var i=g[h];f["filter[where]["+i+"]"]=scope.options.junctionMeta[i]}}GeneralModelService.getMany(d,e,scope.options.relationship,f,{preventCancel:!0}).then(function(a){if(a)if(scope.options.api&&a.length>0){var b={filter:{where:{}}};b.filter.where[scope.options.key]={inq:[]};for(var c in a){var d=a[c];b.filter.where[scope.options.key].inq.push(d[scope.options.key])}apiPath=replaceSessionVariables(scope.options.api),GeneralModelService.list(apiPath,b,{preventCancel:!0}).then(function(a){a&&(scope.selected.items=a,assignJunctionMeta(),scope.list=a)})}else scope.selected.items=a,assignJunctionMeta(),scope.list=a})}else if(scope.data&&scope.options&&scope.options.model){var j=Config.serverParams.models[scope.options.model];if(_.isPlainObject(scope.data))return;GeneralModelService.get(j.plural,scope.data).then(function(a){a&&(scope.selected.item=a,assignJunctionMeta(),scope.list=[scope.selected.item],scope.onModelChanged&&scope.onModelChanged({$item:scope.selected.item}))},function(a){if(scope.options.allowInsert){var b={};b[scope.options.key]=scope.data,b[scope.options.searchField]=scope.data,scope.selected.item=b,assignJunctionMeta(),scope.list.push(b)}})}});scope.onSelect=function(a,b){if(scope.options.multiple){if(a&&"[Add New Item]"==a[scope.options.searchField]){var c=element.find("input.ui-select-search").val();a[scope.key]=c}assignJunctionMeta(),scope.modelData[scope.options.relationship]?mergeArray(scope.selected.items,scope.modelData[scope.options.relationship]):scope.modelData[scope.options.relationship]=scope.selected.items}else{scope.data=a[scope.options.key],scope.rowData&&(scope.rowData[scope.options.key]=scope.data),scope.$emit("onModelFieldReferenceSelect",scope.modelData,scope.key,a,scope.rowData);var d=a[scope.options.searchField];if(a&&"[Add New Item]"==a[scope.options.searchField]){var c=element.find("input.ui-select-search").val();scope.data=c;var e={};e[scope.options.key]=c,e[scope.options.searchField]=c,scope.selected.item=e,scope.list.push(e)}else a&&"[clear]"==a[scope.options.searchField]&&(scope.data=null,d="");if(scope.rowData&&scope.textOutputPath&&a[scope.options.searchField])if(scope.textOutputPath.indexOf(".")>-1){for(var f=scope.textOutputPath.split("."),g=scope.rowData,h=0;h<f.length-1;h++){var i=f[h];g[i]||(g[i]={}),g=g[i]}g[f[f.length-1]]=d}else scope.rowData[scope.textOutputPath]=d;setTimeout(function(){scope.$emit("ngGridEventEndCellEdit")},1)}},scope.onRemove=function(a,b){if(scope.options.multiple){var c=scope.selected.items.indexOf(a);if(c>-1&&(scope.selected.items.splice(c,1),assignJunctionMeta()),scope.modelData[scope.options.relationship]){if(scope.options.key&&a[scope.options.key]){var d={};d[scope.options.key]=a[scope.options.key];var c=_.findIndex(scope.modelData[scope.options.relationship],d);c>-1&&scope.modelData[scope.options.relationship].splice(c,1)}var c=scope.modelData[scope.options.relationship].indexOf(a);c>-1&&scope.modelData[scope.options.relationship].splice(c,1),mergeArray(scope.selected.items,scope.modelData[scope.options.relationship])}else scope.modelData[scope.options.relationship]=scope.selected.items}else scope.data=null},scope.$on("ngGridEventStartCellEdit",function(){element.find("button").trigger("click"),element.find("input.ui-select-search").focus()}),element.html(getTemplate(scope.options.multiple,scope.options.matchTemplate,scope.options.choiceTemplate)).show(),$compile(element.contents())(scope)}}}]),angular.module("dashboard.directives.ModelFieldReferenceSort",["dashboard.Config","dashboard.services.GeneralModel","ui.select"]).directive("modelFieldReferenceSortView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"ngDisabled"},link:function(a,b,c){}}}]).directive("modelFieldReferenceSortEdit",["$compile","$cookies","$timeout","Config","GeneralModelService",function($compile,$cookies,$timeout,Config,GeneralModelService){"ngInject";function getTemplate(a,b,c,d){var e="(index, item) in selectedList";return d||(e+=" track by item."+a),'    <ui-select ng-model="selected.item" on-select="onSelect($item, $model)" ng-required="ngRequired" ng-disabled="disabled" >     <ui-select-match placeholder="{{ options.placeholder }}">'+b+'</ui-select-match>     <ui-select-choices repeat="item in list track by item.'+a+'" refresh="refreshChoices($select.search)" refresh-delay="200">'+c+'</ui-select-choices>     </ui-select>     <ul ui-sortable="sortableOptions" ng-model="selectedList">       <li ng-repeat="'+e+'">         <i class="fa fa-reorder"></i>        <div class="title">'+c+'</div>         <div class="action">           <a href="" ng-click="removeItem(index)" class="remove" ng-hide="disabled"><i class="fa fa-times"></i></a>         </div>       </li>     </ul>'}return{restrict:"E",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(scope,element,attrs){function replaceSessionVariables(string){if("string"!=typeof string)return string;try{for(var session=JSON.parse($cookies.get("session")),searchString="{session.",startPos=string.indexOf(searchString);startPos>-1;){var endPos=string.indexOf("}",startPos);if(-1==endPos){console.error("ModelList session parsing malformed for string");break}var sessionKey=string.substring(startPos+1,endPos);string=string.slice(0,startPos)+eval(sessionKey)+string.slice(endPos+1),startPos=string.indexOf(searchString)}for(searchString="{",startPos=string.indexOf(searchString);startPos>-1;){var endPos=string.indexOf("}",startPos);if(-1==endPos){console.error("ModelList session parsing malformed for string");break}var key=string.substring(startPos+1,endPos);string=string.slice(0,startPos)+scope.modelData[key]+string.slice(endPos+1),startPos=string.indexOf(searchString)}}catch(a){console.error(a)}return string}scope.selected={},scope.selected.item=null,scope.list=[],scope.selectedList=[],scope.sortableOptions={placeholder:"sortable-placeholder",disabled:scope.disabled},scope.refreshChoices=function(a){var b=Config.serverParams.models[scope.options.model],c={"filter[limit]":100};if(c["filter[where]["+scope.options.searchField+"][like]"]="%"+a+"%",scope.options.where){var d=Object.keys(scope.options.where);for(var e in d){var f=d[e];c["filter[where]["+f+"]"]=replaceSessionVariables(scope.options.where[f])}}if(scope.options.filters){var d=Object.keys(scope.options.filters);for(var e in d){var f=d[e];c[f]=replaceSessionVariables(scope.options.filters[f])}}var g=b.plural;scope.options.api&&(g=replaceSessionVariables(scope.options.api)),GeneralModelService.list(g,c).then(function(a){if(a){scope.list=a;for(var b in scope.selectedList){var c=scope.selectedList[b],d={};d[scope.options.key]=c[scope.options.key];var e=_.find(scope.list,d);e&&scope.list.splice(scope.list.indexOf(e),1)}if(scope.options.allowInsert){var f={};f[scope.options.searchField]=scope.options.insertText?scope.options.insertText:"[Add New Item]",scope.list.push(f)}"number"==typeof scope.options.defaultIndex&&a[scope.options.defaultIndex]&&scope.onSelect(a[scope.options.defaultIndex])}})};var unwatch=scope.$watchCollection("[data, options, modelData]",function(a){scope.data&&scope.options&&scope.options.model&&(unwatch(),scope.selectedList=scope.data)});scope.onSelect=function(a,b){if(scope.$emit("onModelFieldReferenceSortSelect",scope.modelData,scope.key,a),!a[scope.options.key]&&a[scope.options.searchField]){var c=element.find("input.ui-select-search").val();a[scope.options.key]=c,a[scope.options.searchField]=c}_.find(scope.selectedList,function(b){return b[scope.options.key]===a[scope.options.key]||b.name&&a.name&&b.name.toLowerCase()===a.name.toLowerCase()})||(scope.selectedList.push(a),scope.data=scope.selectedList),$timeout(function(){delete scope.selected.item})},scope.removeItem=function(a){var b=scope.selectedList[a];scope.selectedList.splice(a,1),scope.list.push(b)},element.html(getTemplate(scope.options.key,scope.options.matchTemplate,scope.options.choiceTemplate,scope.options.allowInsert)).show(),$compile(element.contents())(scope)}}}]),angular.module("dashboard.directives.ModelFieldVideo",["dashboard.services.GeneralModel"]).directive("modelFieldVideoView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ field.label }}</b>: {{ data[field.name] }}",scope:{field:"=options",data:"=ngModel"},link:function(a,b,c){}}}]).directive("modelFieldVideoEdit",["$sce","$compile","$document","GeneralModelService","SessionService",function(a,b,c,d,e){"ngInject";return{restrict:"E",template:'<div class="video-container"><video ng-if="videoUrl" src="{{videoUrl}}" controls></video><div class="placeholder" ng-hide="videoUrl">Upload a Video File</div></div>     <div class="button-menu show-menu">    <button class="btn btn-default upload-button" ng-hide="disabled">Select File</button>     <button class="btn btn-default clear-button" ng-show="imageUrl && !disabled" ng-click="clear()">Clear</button>     </div>     <div ng-file-drop="onFileSelect($files)" ng-file-drag-over-class="optional-css-class-name-or-function" ng-show="dropSupported && !disabled" class="image-drop">{{ uploadStatus }}</div>     <div ng-file-drop-available="dropSupported=true" ng-show="!dropSupported">HTML5 Drop File is not supported!</div>     <input type="file" ng-file-select="onFileSelect($files)" ng-hide="disabled">     <button ng-click="upload.abort()" class="cancel-button">Cancel Upload</button>',scope:{key:"=key",options:"=options",disabled:"=ngDisabled",data:"=ngModel",modelData:"=modelData"},link:function(b,d,e){var f=null;b.uploadStatus="Upload File";var g=b.$watch("data",function(c){c&&(g(),"string"==typeof c?b.videoUrl=a.trustAsResourceUrl(c):"object"==typeof c&&(c.fileUrl&&(b.videoUrl=a.trustAsResourceUrl(c.fileUrl)),c.videoUrl&&(b.videoUrl=a.trustAsResourceUrl(c.videoUrl))))}),h=new FileReader;h.onload=function(c){b.videoUrl=a.trustAsResourceUrl(c.target.result),b.$apply()},h.onerror=function(a){console.error(a)},b.clear=function(){b.data=null,delete b.videoUrl},b.onFileSelect=function(a){if(!(a.length<1)){f=a[0];var c=b.options.path;b.data={path:c,file:f},h.readAsDataURL(f)}},c.on("drop",function(a){"INPUT"!=a.target.nodeName&&a.preventDefault()}),c.on("dragover",function(a){a.preventDefault(),d.find(".image-drop").addClass("show-upload"),d.find(".input[type=file]").addClass("show-upload"),d.find(".button-menu").addClass("hide-menu")}),$(window).on("mouseleave",function(){d.find(".image-drop").removeClass("show-upload"),d.find(".input[type=file]").removeClass("show-upload"),d.find(".button-menu").removeClass("hide-menu")}),b.$on("$destroy",function(){c.off("drop"),c.off("dragover"),$(window).off("mouseleave")})}}}]),angular.module("dashboard.directives.ModelFieldWYSIWYG",["dashboard.Dashboard.Model.Edit.SaveDialog","dashboard.Config","ui.bootstrap","dashboard.services.GeneralModel","ui.select"]).directive("modelFieldWysiwygView",["$compile",function(a){"ngInject";return{restrict:"E",template:"<b>{{ options.model }}</b>: {{ data[options.key] }}",scope:{options:"=options",data:"=ngModel",required:"ngRequired",disabled:"disabled"},link:function(a,b,c){}}}]).directive("modelFieldWysiwygEdit",["$compile","$cookies","$timeout","$uibModal","Config","FileUploadService",function(a,b,c,d,e,f){"ngInject";function g(a){var b="";if(a.options&&a.options.fonts)for(var c=a.options.fonts,d=0;d<c.length;d++)b+='<li><a data-edit="fontName '+c[d]+'" style="font-family: \''+c[d]+"';\">"+c[d]+"</a></li>";return'      <div class="wysiwyg-toolbar" data-role="editor-toolbar" data-target=".wysiwyg-editor" ng-hide="disabled">        <div class="btn-group" ng-show="options && options.fonts">          <span class="dropdown">          <a class="btn btn-default" title="Font" ng-click="toggleDropdown($event)" ng-disabled="isEditingCode"><i class="fa fa-font"></i>&nbsp;<b class="caret"></b></a>          <ul class="menu" ng-click="toggleDropdown($event)">'+b+'</ul></span>        </div>        <div class="btn-group">          <span class="dropdown">          <a class="btn btn-default" title="Font Size" ng-click="toggleDropdown($event)" ng-disabled="isEditingCode"><i class="fa fa-text-height"></i>&nbsp;<b class="caret"></b></a>          <ul class="menu" ng-click="toggleDropdown($event)" >            <li><a data-edit="fontSize 7">24 pt</a></li>            <li><a data-edit="fontSize 6">18 pt</a></li>            <li><a data-edit="fontSize 5">16 pt</a></li>            <li><a data-edit="fontSize 4">14 pt</a></li>            <li><a data-edit="fontSize 3">12 pt</a></li>            <li><a data-edit="fontSize 2">10 pt</a></li>            <li><a data-edit="fontSize 1">7 pt</a></li>          </ul></span>        </div>        <div class="btn-group">          <span class="dropdown">          <a class="btn btn-default color-picker" title="Font Color" ng-click="toggleDropdown($event)" ng-disabled="isEditingCode"><i class="color-sample"></i>&nbsp;<b class="caret"></b></a>          <div class="menu input-append">            <input type="color" class="font-color-picker" value="#000" />          </div></span>        </div>        <div class="btn-group">          <a class="btn btn-default" data-edit="bold" title="Bold" ng-disabled="isEditingCode"><i class="fa fa-bold"></i></a>          <a class="btn btn-default" data-edit="italic" title="Italic" ng-disabled="isEditingCode"><i class="fa fa-italic"></i></a>          <a class="btn btn-default" data-edit="underline" title="Underline" ng-disabled="isEditingCode"><i class="fa fa-underline"></i></a>        </div>        <div class="btn-group">          <a class="btn btn-default" data-edit="insertunorderedlist" title="Bullet list" ng-disabled="isEditingCode"><i class="fa fa-list-ul"></i></a>          <a class="btn btn-default" data-edit="insertorderedlist" title="Number list" ng-disabled="isEditingCode"><i class="fa fa-list-ol"></i></a>          <a class="btn btn-default" data-edit="outdent" title="Reduce indent" ng-disabled="isEditingCode"><i class="fa fa-dedent"></i></a>          <a class="btn btn-default" data-edit="indent" title="Indent" ng-disabled="isEditingCode"><i class="fa fa-indent"></i></a>        </div>        <div class="btn-group">          <a class="btn btn-default" data-edit="justifyleft" title="Align Left" ng-disabled="isEditingCode"><i class="fa fa-align-left"></i></a>          <a class="btn btn-default" data-edit="justifycenter" title="Center" ng-disabled="isEditingCode"><i class="fa fa-align-center"></i></a>          <a class="btn btn-default" data-edit="justifyright" title="Align Right" ng-disabled="isEditingCode"><i class="fa fa-align-right"></i></a>          <a class="btn btn-default" data-edit="justifyfull" title="Justify" ng-disabled="isEditingCode"><i class="fa fa-align-justify"></i></a>        </div>        <div class="btn-group">          <span class="dropdown">          <a class="btn btn-default" data-original-title="Hyperlink" ng-click="toggleDropdown($event)" ng-disabled="isEditingCode"><i class="fa fa-link"></i></a>          <div class="menu">            <input class="form-control" placeholder="URL" type="text" data-edit="createLink">            <button class="btn btn-default add-button" type="button">Add</button>          </div></span>        </div>        <div class="btn-group picture-button">          <a class="btn btn-default picture-tool" title="Insert picture (or just drag & drop)" ng-disabled="!options.allowImageUpload || isEditingCode"><i class="fa fa-picture-o"></i></a>          <input type="file" class="wysiwyg-picture-input" data-role="magic-overlay" data-target=".wysiwyg-toolbar .picture-tool" ng-file-select="onFileSelect($files)"  ng-disabled="!options.allowImageUpload || isEditingCode" />        </div>        <div class="btn-group">          <a class="btn btn-default" data-edit="undo" title="Undo" ng-disabled="isEditingCode"><i class="fa fa-undo"></i></a>          <a class="btn btn-default" data-edit="redo" title="Redo" ng-disabled="isEditingCode"><i class="fa fa-repeat"></i></a>        </div>        <div class="btn-group">          <a class="btn btn-default" title="Edit HTML" ng-click="toggleCodeEdit()"><i class="fa fa-code"></i></a>        </div>      </div>      <div class="wysiwyg-editor" ng-hide="isEditingCode"></div>      <div class="code-editor" ng-show="isEditingCode"></div>    '}return{restrict:"E",require:"ngModel",scope:{key:"=key",property:"=property",options:"=options",data:"=ngModel",modelData:"=modelData",disabled:"=ngDisabled"},link:function(b,c,e,h){function i(){var a=$(".wysiwyg-editor"),d=0;a&&a.length>0&&(d=a.length),n=angular.element(c).find(".wysiwyg-editor");var e="wysiwyg-editor-"+d,f="editor"+d+"-toolbar";n.attr("id",e);var g=angular.element(c).find(".wysiwyg-toolbar");g.attr("data-role",f),g.attr("data-target","#"+e),b.disabled||n.wysiwyg({toolbarSelector:"[data-role="+f+"]",hotKeys:{},dragAndDropImages:!1})}function j(){var a=angular.element(c).find(".font-color-picker");a&&a.spectrum({flat:!0,cancelText:"",clickoutFiresChange:!1,preferredFormat:"rgb",showInput:!0,change:function(a){$(this).closest(".dropdown").find(".color-sample").css({backgroundColor:a.toHexString()}),n.focus(),document.execCommand("foreColor",0,a.toHexString()),$(this).parent(".menu").removeClass("open")}})}function k(a){var b=$(a.currentTarget).parent().find(".menu");b.hasClass("open")?b.removeClass("open"):b.addClass("open")}function l(a){if(b.options.allowImageUpload&&0!=a.length){b.status="Uploading Image",b.progress=0;var c=d.open({templateUrl:"app/dashboard/model/edit/ModelEditSaveDialog.html",controller:"ModelEditSaveDialogCtrl",scope:b});f.uploadFile(a[0],b.options.imagePath).then(function(a){b.status="Upload Complete",document.execCommand("insertimage",0,a.fileUrl),c.close()},function(a){console.error(a),b.status="There was an error uploading the image. Please contact an Administrator."},function(a){b.progress=a})}}function m(){if(b.isEditingCode=!b.isEditingCode,b.isEditingCode){var a=n[0].innerHTML;a=html_beautify(a,{indent_size:2}),h.$setViewValue(a),o.setValue(a)}else h.$setViewValue(o.getValue()),n.html(h.$viewValue)}var n,o;!function(){b.isEditingCode=!1,b.toggleDropdown=k,b.onFileSelect=l,b.toggleCodeEdit=m,c.html(g(b)).show(),a(c.contents())(b),i(),j(),o=ace.edit(c.find(".code-editor")[0]),o.getSession().setMode("ace/mode/html"),$(c).find(".wysiwyg-toolbar [data-role=magic-overlay]").each(function(){var a=$(this);$(a.data("target")),a.css({opacity:0,position:"absolute",width:"40px",height:"34px",top:"0",left:"0"})}),h.$render=function(){n.html(h.$viewValue||"")},n.bind("blur keyup change",function(){b.$apply(function(){h.$setViewValue(n.html())})}),o.on("blur",function(){h.$setViewValue(o.getValue()),n.html(h.$viewValue)})}()}}}]),angular.module("dashboard.directive.AutoSize",[]).directive("autoSize",["$timeout","$window",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){d.css({height:"auto","overflow-y":"hidden"}),d.css("height",d[0].scrollHeight+"px")}c.minTextAreaHeight=150,d.css({height:"auto","overflow-y":"hidden"}),a(function(){var a=d[0].scrollHeight,b=Math.max(a,c.minTextAreaHeight);d.css("height",b+"px")},100),d.on("input",f),d.on("load",f),angular.element(b).bind("resize",f)}}}]),angular.module("dashboard.filters",[]).filter("decimalWithScale",function(){"ngInject";return function(a,b){if(void 0===a||""===a)return"";value=a+"";var c=value.indexOf(".");-1===c?value+=".0":1===c&&"-"===value.charAt(0)?value=value.slice(0,1)+"0"+value.slice(1):0===c&&(value="0"+value);var d=value.split(".");if(d.length>1){if(d[0]&&0!==d[0].length||(d[0]=0),isNaN(parseInt(d[0])))return NaN;if(1===c&&"-"===value.charAt(0)?value="-"+parseInt(d[0])+".":value=parseInt(d[0])+".",null!==d[1].match(/[\D]/))return NaN;if(d[1].length>b?value+=d[1].substring(0,b):value+=d[1],d[1].length<b)for(var e=0;e<b-d[1].length;e++)value+="0"}return value}}),angular.module("dashboard.filters.locale",[]).filter("iso-639-1",function(){"ngInject";var a={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};return function(b){return b||(b="eng"),a[b.toLowerCase()]}}),angular.module("dashboard.services.Cache",["dashboard.Config","dashboard.Utils","ngCookies"]).service("CacheService",function(){"ngInject";this.KEY_DELIMITER="-",this.get=function(a){if(!localStorage.getItem(a))return null;try{return JSON.parse(localStorage.getItem(a))}catch(a){return null}},this.set=function(a,b){try{localStorage.setItem(a,JSON.stringify(b))}catch(b){this.remove(a)}},this.remove=function(a){localStorage.removeItem(a)},this.getKeyForAction=function(a,b){var c=a.options.model+this.KEY_DELIMITER+a.route;return a.options.api&&(c=a.options.api),b&&(c+=this.KEY_DELIMITER+JSON.stringify(b)),c},this.clear=function(a){var b=a,c=new RegExp("^"+b);for(var d in localStorage)c.test(d)&&this.remove(d)},this.reset=function(){localStorage.clear()}}),angular.module("dashboard.services.Dashboard",["dashboard.Config","dashboard.Utils"]).service("DashboardService",["$cookies","Config",function(a,b){"ngInject";var c=this,d=[],e=[];this.getNavigation=function(){var f=angular.fromJson(a.get("roles"));if(_.isEmpty(e)||!_.isEqual(d,f)){d=f;var g=angular.copy(b.serverParams.nav);e=c.restrictMenuItems(g)}return e},this.getDefaultNav=function(a,b){if(b.state)return b;if(b.params&&!b.params.action){var c=_.find(a,{path:b.params.model});if(c){if(c.hidden){for(var d=0;d<a.length&&(c=a[d],b={params:{model:c.path}},c.hidden);d++);if(c.hidden)return null}var e=c.subnav[c.defaultSubNavIndex];e?(b.params||(b.params={}),b.params.action=e.label,b.route=e.route):console.error("No defaultSubNavIndex defined in nav",c)}}return b},this.restrictMenuItems=function(a){for(var b in a){var e=a[b];if(c.hasAccess(d,e)){if(e.hasOwnProperty("subnav")&&e.subnav.length>0){var f=this.restrictMenuItems(e.subnav);if(f&&(e.subnav=f,null!==e.defaultSubNavIndex&&void 0!==e.defaultSubNavIndex&&e.subnav[e.defaultSubNavIndex]&&e.subnav[e.defaultSubNavIndex].hidden))for(var g in e.subnav){var h=e.subnav[g];if(c.hasAccess(d,h)&&!h.hidden){e.defaultSubNavIndex=parseInt(g);break}}}}else e.hidden=!0}return a},this.hasAccess=function(a,b){if(!(b.hasOwnProperty("roles")&&b.roles instanceof Array))return!0;for(var c in a)if(b.roles.indexOf(a[c].name)>-1)return!0;return!1}}]),angular.module("dashboard.services.FileUpload",["dashboard.Config","dashboard.Utils","ngCookies","angularFileUpload"]).service("FileUploadService",["$cookies","$q","$upload","Config","Utils",function(a,b,c,d,e){"ngInject";var f=this;this.getS3Credentials=function(b,c){
var f={access_token:a.get("accessToken"),path:b,fileType:c,r:(new Date).getTime()};return e.apiHelper("GET",d.serverParams.cmsBaseUrl+"/aws/s3/credentials",f)},this.getFileUploadData=function(a){return{key:a.uniqueFilePath,AWSAccessKeyId:a.AWSAccessKeyId,acl:"private",policy:a.policy,signature:a.signature,success_action_status:"201","Cache-Control":"max-age=31536000"}},this.uploadFile=function(a,d){("string"==typeof a||a instanceof String&&0==a.indexOf("data:"))&&(a=f.dataURItoBlob(a));var e="";a.type?e=a.type:a.name&&(e=f.detectMimeTypeByExt(a.name));var g=b.defer();return f.getS3Credentials(d,e||"").then(function(b){c.upload({url:b.uploadUrl,method:"POST",data:f.getFileUploadData(b),file:a}).progress(function(b){var c=b.position/a.size;g.notify(c)}).success(function(b){var c,d=(new DOMParser).parseFromString(b,"text/xml");try{var e=d.evaluate("/PostResponse/Location",d,null,XPathResult.STRING_TYPE,null);c=e.stringValue}catch(a){for(var f=d.documentElement.childNodes,h=0;h<f.length;h++){var i=f[h];if("Location"==i.nodeName){c=i.firstChild.nodeValue;break}}}g.resolve({filename:a.name,size:a.size,fileUrl:c})}).error(function(a){console.log(a),g.reject(a)})},function(a){console.log(a),g.reject(a)}),g.promise};var g=null;this.uploadImages=function(a){var d=arguments[1],e=arguments[2],h=arguments[3],i=arguments[4];d||(d=0),e||(e=0),i||(i=b.defer());var j=null,k=null,l=null,m=0,n=0;if(a&&a instanceof Array&&d<a.length){if(d++,e=0,1==k)return void f.uploadImages(a,d,e,h,i);a[d]&&a[d].file?(g=a[d].path,l=a[d].file):l=a[d],h||(h=[]);for(var o=0;o<a.length;o++){var p=a[o].file?a[o].file:a[o];o<d&&(m+=p.size),n+=p.size}}else if("object"==typeof a&&!a.file&&d<Object.keys(a).length){var q=Object.keys(a);j=q[d];var r=a[j].file?a[j].file:a[j];if(a[j].path&&(g=a[j].path),r&&r.type&&r.size){if(e>0)return d++,e=0,void f.uploadImages(a,d,e,h,i);l=r}else{var s=Object.keys(r);if(e>=s.length)return d++,e=0,void f.uploadImages(a,d,e,h,i);k=s[e],r[k]&&r[k].file?(g=r[k].path,l=r[k].file):l=r[k]}h||(h={});for(var o=0;o<q.length;o++){var t=q[o],r=a[t];if(r&&r.type&&r.size){var p=r;o<d&&(m+=p.size),n+=p.size}else if(r&&r.file){var p=r.file;o<d&&(m+=p.size),n+=p.size}else for(var u=0;u<s.length;u++){var v=s[u],p=r[v].file?r[v].file:r[v];(o<d||o==d&&u<e)&&(m+=p.size),n+=p.size}}}return l?(f.getS3Credentials(g,l.type).then(function(b){c.upload({url:b.uploadUrl,method:"POST",data:f.getFileUploadData(b),file:l}).progress(function(a){var b=(m+a.position)/n;i.notify(b)}).success(function(b){var c,g=(new DOMParser).parseFromString(b,"text/xml");try{var l=g.evaluate("/PostResponse/Location",g,null,XPathResult.STRING_TYPE,null);c=l.stringValue}catch(a){for(var m=g.documentElement.childNodes,n=0;n<m.length;n++){var o=m[n];if("Location"==o.nodeName){c=o.firstChild.nodeValue;break}}}j?k?(h[j]||(h[j]={}),h[j][k]=c):h[j]=c:h.push(c),e++,f.uploadImages(a,d,e,h,i)}).error(function(a){console.log(a),i.reject(a)})},function(a){console.log(a),i.reject(a)}),i.promise):(i.resolve(h),i.promise)},this.dataURItoBlob=function(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},this.detectMimeTypeByExt=function(a){if(a.length>0){var b=a.split(".").pop();if(b.length>0){return{"3dm":"x-world/x-3dmf","3dmf":"x-world/x-3dmf",a:"application/octet-stream",aab:"application/x-authorware-bin",aam:"application/x-authorware-map",aas:"application/x-authorware-seg",abc:"text/vnd.abc",acgi:"text/html",afl:"video/animaflex",ai:"application/postscript",aif:"audio/aiff",aifc:"audio/aiff",aiff:"audio/aiff",aim:"application/x-aim",aip:"text/x-audiosoft-intra",ani:"application/x-navi-animation",aos:"application/x-nokia-9000-communicator-add-on-software",aps:"application/mime",arc:"application/octet-stream",arj:"application/arj",art:"image/x-jg",asf:"video/x-ms-asf",asm:"text/x-asm",asp:"text/asp",asx:"application/x-mplayer2",au:"audio/basic",avi:"application/x-troff-msvideo",avs:"video/avs-video",bcpio:"application/x-bcpio",bin:"application/mac-binary",bm:"image/bmp",bmp:"image/bmp",boo:"application/book",book:"application/book",boz:"application/x-bzip2",bsh:"application/x-bsh",bz:"application/x-bzip",bz2:"application/x-bzip2",c:"text/plain","c++":"text/plain",cat:"application/vnd.ms-pki.seccat",cc:"text/plain",ccad:"application/clariscad",cco:"application/x-cocoa",cdf:"application/cdf",cer:"application/pkix-cert",cha:"application/x-chat",chat:"application/x-chat",class:"application/java",com:"application/octet-stream",conf:"text/plain",cpio:"application/x-cpio",cpp:"text/x-c",cpt:"application/mac-compactpro",crl:"application/pkcs-crl",crt:"application/pkix-cert",csh:"application/x-csh",css:"application/x-pointplus",cxx:"text/plain",dcr:"application/x-director",deepv:"application/x-deepv",def:"text/plain",der:"application/x-x509-ca-cert",dif:"video/x-dv",dir:"application/x-director",dl:"video/dl",doc:"application/msword",dot:"application/msword",dp:"application/commonground",drw:"application/drafting",dump:"application/octet-stream",dv:"video/x-dv",dvi:"application/x-dvi",dwf:"drawing/x-dwf (old)",dwg:"application/acad",dxf:"application/dxf",dxr:"application/x-director",el:"text/x-script.elisp",elc:"application/x-bytecode.elisp (compiled elisp)",env:"application/x-envoy",eps:"application/postscript",es:"application/x-esrehber",etx:"text/x-setext",evy:"application/envoy",exe:"application/octet-stream",f:"text/plain",f77:"text/x-fortran",f90:"text/plain",fdf:"application/vnd.fdf",fif:"application/fractals",fli:"video/fli",flo:"image/florian",flx:"text/vnd.fmi.flexstor",fmf:"video/x-atomic3d-feature",for:"text/plain",fpx:"image/vnd.fpx",frl:"application/freeloader",funk:"audio/make",g:"text/plain",g3:"image/g3fax",gif:"image/gif",gl:"video/gl",gsd:"audio/x-gsm",gsm:"audio/x-gsm",gsp:"application/x-gsp",gss:"application/x-gss",gtar:"application/x-gtar",gz:"application/x-compressed",gzip:"application/x-gzip",h:"text/plain",hdf:"application/x-hdf",help:"application/x-helpfile",hgl:"application/vnd.hp-hpgl",hh:"text/plain",hlb:"text/x-script",hlp:"application/hlp",hpg:"application/vnd.hp-hpgl",hpgl:"application/vnd.hp-hpgl",hqx:"application/binhex",hta:"application/hta",htc:"text/x-component",htm:"text/html",html:"text/html",htmls:"text/html",htt:"text/webviewhtml",htx:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",idc:"text/plain",ief:"image/ief",iefs:"image/ief",iges:"application/iges",igs:"application/iges",ima:"application/x-ima",imap:"application/x-httpd-imap",inf:"application/inf",ins:"application/x-internett-signup",ip:"application/x-ip2",isu:"video/x-isvideo",it:"audio/it",iv:"application/x-inventor",ivr:"i-world/i-vrml",ivy:"application/x-livescreen",jam:"audio/x-jam",jav:"text/plain",java:"text/plain",jcm:"application/x-java-commerce",jfif:"image/jpeg","jfif-tbnl":"image/jpeg",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",jps:"image/x-jps",js:"application/x-javascript",jut:"image/jutvision",kar:"audio/midi",ksh:"application/x-ksh",la:"audio/nspaudio",lam:"audio/x-liveaudio",latex:"application/x-latex",lha:"application/lha",lhx:"application/octet-stream",list:"text/plain",lma:"audio/nspaudio",log:"text/plain",lsp:"application/x-lisp",lst:"text/plain",lsx:"text/x-la-asf",ltx:"application/x-latex",lzh:"application/octet-stream",lzx:"application/lzx",m:"text/plain",m1v:"video/mpeg",m2a:"audio/mpeg",m2v:"video/mpeg",m3u:"audio/x-mpequrl",man:"application/x-troff-man",map:"application/x-navimap",mar:"text/plain",mbd:"application/mbedlet",mc$:"application/x-magic-cap-package-1.0",mcd:"application/mcad",mcf:"image/vasa",mcp:"application/netmc",me:"application/x-troff-me",mht:"message/rfc822",mhtml:"message/rfc822",mid:"application/x-midi",midi:"application/x-midi",mif:"application/x-frame",mime:"message/rfc822",mjf:"audio/x-vnd.audioexplosion.mjuicemediafile",mjpg:"video/x-motion-jpeg",mm:"application/base64",mme:"application/base64",mod:"audio/mod",moov:"video/quicktime",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg3",mpa:"audio/mpeg",mpc:"application/x-project",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"audio/mpeg",mpga:"audio/mpeg",mpp:"application/vnd.ms-project",mpt:"application/x-project",mpv:"application/x-project",mpx:"application/x-project",mrc:"application/marc",ms:"application/x-troff-ms",mv:"video/x-sgi-movie",my:"audio/make",mzz:"application/x-vnd.audioexplosion.mzz",nap:"image/naplps",naplps:"image/naplps",nc:"application/x-netcdf",ncm:"application/vnd.nokia.configuration-message",nif:"image/x-niff",niff:"image/x-niff",nix:"application/x-mix-transfer",nsc:"application/x-conference",nvd:"application/x-navidoc",o:"application/octet-stream",oda:"application/oda",omc:"application/x-omc",omcd:"application/x-omcdatamaker",omcr:"application/x-omcregerator",p:"text/x-pascal",p10:"application/pkcs10",p12:"application/pkcs-12",p7a:"application/x-pkcs7-signature",p7c:"application/pkcs7-mime",p7m:"application/pkcs7-mime",p7r:"application/x-pkcs7-certreqresp",p7s:"application/pkcs7-signature",part:"application/pro_eng",pas:"text/pascal",pbm:"image/x-portable-bitmap",pcl:"application/vnd.hp-pcl",pct:"image/x-pict",pcx:"image/x-pcx",pdb:"chemical/x-pdb",pdf:"application/pdf",pfunk:"audio/make",pgm:"image/x-portable-graymap",pic:"image/pict",pict:"image/pict",pkg:"application/x-newton-compatible-pkg",pko:"application/vnd.ms-pki.pko",pl:"text/plain",plx:"application/x-pixclscript",pm:"image/x-xpixmap",pm4:"application/x-pagemaker",pm5:"application/x-pagemaker",png:"image/png",pnm:"application/x-portable-anymap",pot:"application/mspowerpoint",pov:"model/x-pov",ppa:"application/vnd.ms-powerpoint",ppm:"image/x-portable-pixmap",pps:"application/mspowerpoint",ppt:"application/mspowerpoint",ppz:"application/mspowerpoint",pre:"application/x-freelance",prt:"application/pro_eng",ps:"application/postscript",psd:"application/octet-stream",pvu:"paleovu/x-pv",pwz:"application/vnd.ms-powerpoint",py:"text/x-script.phyton",pyc:"application/x-bytecode.python",qcp:"audio/vnd.qcelp",qd3:"x-world/x-3dmf",qd3d:"x-world/x-3dmf",qif:"image/x-quicktime",qt:"video/quicktime",qtc:"video/x-qtc",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"application/x-cmu-raster",rast:"image/cmu-raster",rexx:"text/x-script.rexx",rf:"image/vnd.rn-realflash",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",rmi:"audio/mid",rmm:"audio/x-pn-realaudio",rmp:"audio/x-pn-realaudio",rng:"application/ringing-tones",rnx:"application/vnd.rn-realplayer",roff:"application/x-troff",rp:"image/vnd.rn-realpix",rpm:"audio/x-pn-realaudio-plugin",rt:"text/richtext",rtf:"application/rtf",rtx:"application/rtf",rv:"video/vnd.rn-realvideo",s:"text/x-asm",s3m:"audio/s3m",saveme:"application/octet-stream",sbk:"application/x-tbook",scm:"application/x-lotusscreencam",sdml:"text/plain",sdp:"application/sdp",sdr:"application/sounder",sea:"application/sea",set:"application/set",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-bsh",shar:"application/x-bsh",shtml:"text/html",sid:"audio/x-psid",sit:"application/x-sit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",sl:"application/x-seelogo",smi:"application/smil",smil:"application/smil",snd:"audio/basic",sol:"application/solids",spc:"application/x-pkcs7-certificates",spl:"application/futuresplash",spr:"application/x-sprite",sprite:"application/x-sprite",src:"application/x-wais-source",ssi:"text/x-server-parsed-html",ssm:"application/streamingmedia",sst:"application/vnd.ms-pki.certstore",step:"application/step",stl:"application/sla",stp:"application/step",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svf:"image/vnd.dwg",svr:"application/x-world",swf:"application/x-shockwave-flash",t:"application/x-troff",talk:"text/x-speech",tar:"application/x-tar",tbk:"application/toolbook",tcl:"application/x-tcl",tcsh:"text/x-script.tcsh",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"application/plain",tgz:"application/gnutar",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsi:"audio/tsp-audio",tsp:"application/dsptype",tsv:"text/tab-separated-values",turbot:"image/florian",txt:"text/plain",uil:"text/x-uil",uni:"text/uri-list",unis:"text/uri-list",unv:"application/i-deas",uri:"text/uri-list",uris:"text/uri-list",ustar:"application/x-ustar",uu:"application/octet-stream",uue:"text/x-uuencode",vcd:"application/x-cdlink",vcs:"text/x-vcalendar",vda:"application/vda",vdo:"video/vdo",vew:"application/groupwise",viv:"video/vivo",vivo:"video/vivo",vmd:"application/vocaltec-media-desc",vmf:"application/vocaltec-media-file",voc:"audio/voc",vos:"video/vosaic",vox:"audio/voxware",vqe:"audio/x-twinvq-plugin",vqf:"audio/x-twinvq",vql:"audio/x-twinvq-plugin",vrml:"application/x-vrml",vrt:"x-world/x-vrt",vsd:"application/x-visio",vst:"application/x-visio",vsw:"application/x-visio",w60:"application/wordperfect6.0",w61:"application/wordperfect6.1",w6w:"application/msword",wav:"audio/wav",wb1:"application/x-qpro",wbmp:"image/vnd.wap.wbmp",web:"application/vnd.xara",wiz:"application/msword",wk1:"application/x-123",wmf:"windows/metafile",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",word:"application/msword",wp:"application/wordperfect",wp5:"application/wordperfect",wp6:"application/wordperfect",wpd:"application/wordperfect",wq1:"application/x-lotus",wri:"application/mswrite",wrl:"application/x-world",wrz:"model/vrml",wsc:"text/scriplet",wsrc:"application/x-wais-source",wtk:"application/x-wintalk",xbm:"image/x-xbitmap",xdr:"video/x-amt-demorun",xgz:"xgl/drawing",xif:"image/vnd.xiff",xl:"application/excel",xla:"application/excel",xlb:"application/excel",xlc:"application/excel",xld:"application/excel",xlk:"application/excel",xll:"application/excel",xlm:"application/excel",xls:"application/excel",xlt:"application/excel",xlv:"application/excel",xlw:"application/excel",xm:"audio/xm",xml:"application/xml",xmz:"xgl/movie",xpix:"application/x-vnd.ls-xpix",xpm:"image/x-xpixmap","x-png":"image/png",xsr:"video/x-amt-showrun",xwd:"image/x-xwd",xyz:"chemical/x-pdb",z:"application/x-compress",zip:"application/x-compressed",zoo:"application/octet-stream",zsh:"text/x-script.zsh"}[b]}}return""}}]),angular.module("dashboard.services.GeneralModel",["dashboard.services.FileUpload","dashboard.Config","dashboard.Utils","ngCookies"]).service("GeneralModelService",["$cookies","$q","Config","Utils","FileUploadService",function($cookies,$q,Config,Utils,FileUploadService){"ngInject";var self=this;this.list=function(a,b,c){var a=a+(a.indexOf("?")>-1?"&":"?")+"access_token="+$cookies.get("accessToken");return c&&c.preventCancel||Utils.apiCancel("GET",a),Utils.apiHelper("GET",a,b)},this.count=function(a,b){a.indexOf("?")>-1&&(a=a.substr(0,a.indexOf("?")));var c=Object.keys(b);for(var d in c){var e=c[d];e.indexOf("filter[where]")>-1?(newKey=e.replace("filter[where]","where"),b[newKey]=b[e]):"filter"==e&&(b.where=b.filter.where)}return a=a+"/count?access_token="+$cookies.get("accessToken"),Utils.apiCancel("GET",a),Utils.apiHelper("GET",a,b)},this.get=function(a,b,c){var d=a+"/"+b+"?access_token="+$cookies.get("accessToken");return Utils.apiHelper("GET",d,c)},this.getMany=function(a,b,c,d,e){var f=a+"/"+b+"/"+c,g=f+"?access_token="+$cookies.get("accessToken");return e&&e.preventCancel||Utils.apiCancel("GET",g),Utils.apiHelper("GET",g,d)},this.sort=function(a,b,c,d){var e=Config.serverParams.cmsBaseUrl+"/model/sort?access_token="+$cookies.accessToken,f={model:a,key:b,sortField:c,sortData:d};return Utils.apiHelper("POST",e,f)},this.remove=function(a,b){var c=a;return b&&(c=c+"/"+b),c+="?access_token="+$cookies.get("accessToken"),Utils.apiHelper("DELETE",c,{})},this.post=function(a,b){var c=a+"?access_token="+$cookies.get("accessToken");return Utils.apiHelper("POST",c,b)},this.save=function(a,b,c){var d=Config.serverParams.cmsBaseUrl+"/model/save";return c.__model=a,c.__id=b,c.__accessToken=$cookies.get("accessToken"),Utils.apiHelper("PUT",d,c)},this.saveWithFiles=function(a,b,c){var d=Config.serverParams.models[a],e=$q.defer(),f=function(a){var b=0,d=Object.keys(c),f=function(){if(b>=d.length)return void a();var g=d[b],h=c[g];h&&"object"==typeof h&&h.file?(e.notify({message:"Uploading file: "+h.file.name,translate:"cms.status.uploading_file",params:{file:h.file.name},progress:0}),FileUploadService.uploadFile(h.file,h.path).then(function(a){c[g]=a.fileUrl,b++,f()},function(a){"object"==typeof a&&a.error?e.reject({message:"The file being uploaded is not an accepted file type for this form",translate:"cms.error.file_upload.not_accepted"}):e.reject(a)},function(a){e.notify({progress:a})})):(b++,f())};f()};return function(a){c.__ModelFieldImageData?(e.notify({message:"Uploading image file(s)",progress:0,translate:"cms.status.uploading_image_files"}),FileUploadService.uploadImages(c.__ModelFieldImageData).then(function(b){self.assignImageFileMetaData(d,c,b),e.notify({message:"Saving...",progress:0,translate:"cms.status.saving"}),a()},function(a){console.log(a),e.reject(a)},function(a){e.notify({progress:a})})):a()}(function(){f(function(){self.checkDefaultValues(d,c),self.save(a,b,c).then(function(a){e.resolve(a)},function(a){e.reject(a)})})}),e.promise},this.assignImageFileMetaData=function(a,b,c){var d=Object.keys(c);for(var e in d){var f=d[e],g=a.properties[f],h=g.display.options;if(h&&h.model&&h.relationship){b[h.relationship]||(b[h.relationship]={});var i=b[h.relationship];b[f]&&(i[h.key]=b[f]),i[h.urlKey]=c[f][h.urlKey];var j=Object.keys(h.export);for(var k in j){var l=j[k];i[l]=c[f][l]}if(b.__ModelFieldImageData[f]&&b.__ModelFieldImageData[f][h.urlKey]){var m=b.__ModelFieldImageData[f][h.urlKey],n=m?m.file:{};i.filename=n.name}else i.filename="unknown";if(h.meta){var o=Object.keys(h.meta);for(var p in o){var q=o[p];i[q]=h.meta[q]}}}else b[f]=c[f]}delete b.__ModelFieldImageData,delete b.__ModelFieldImageChangeCount},this.checkDefaultValues=function(modelDef,data){var keys=Object.keys(modelDef.properties);for(var i in keys){var key=keys[i],property=modelDef.properties[key];property&&property.display&&(void 0===data[key]||null==data[key]||property.display.forceDefaultOnSave)&&(void 0!==property.default&&(data[key]=property.default),void 0!==property.display.evalDefault&&(data[key]=eval(property.display.evalDefault)))}},this.queryStringParamsToJSON=function(a){var b={};return _.forEach(a,function(a,c){b=_.set(b,c,a)}),b},this.validateRequiredFields=function(a,b,c){var d=c?a[c]:a.display,e=d.filter(function(c){if("string"==typeof c){var d=a.properties[c];return d&&d.required&&!b[c]}return!("object"!=typeof c||!c.required)&&(c.options&&c.options.relationship?_.isEmpty(b[c.options.relationship]):"image"===c.type&&b.__ModelFieldImageData?_.isEmpty(b.__ModelFieldImageData[c.property]):_.isEmpty(b[c.property]))});return _.isEmpty(e)}}]),angular.module("dashboard.services.Image",[]).service("ImageService",["$q",function(a){"ngInject";var b=this;this.resize=function(a,c,d){b.loadImageURI(a,function(e,f){if(e)return d(e);EXIF.getData(f,function(e){var g=document.createElement("canvas"),h=g.getContext("2d"),i=EXIF.getTag(this,"Orientation");c||(c={});var j=c.width?c.width:f.width,k=c.height?c.height:f.height;switch(c.aspect?c.aspect:"fit"){case"stretch":g.width=j,g.height=k;break;case"fill":g.width=j,g.height=k;var l=Math.max(j/f.width,k/f.height);j=f.width*l,k=f.height*l;break;case"fit":default:var l=Math.min(j/f.width,k/f.height);l>1&&(l=1),j=f.width*l,k=f.height*l,g.width=j,g.height=k}h.save(),b.setOrientation(g,h,j,k,i),h.drawImage(f,0,0,j,k),h.restore();try{var m=g.toDataURL("image/jpeg",.8);d(null,m)}catch(b){d(null,a)}})})},this.fixOrientationWithDataURI=function(a,c){b.resize(a,{},c)},this.setOrientation=function(a,b,c,d,e){switch(e){case 2:b.translate(c,0),b.scale(-1,1);break;case 3:b.translate(c,d),b.rotate(Math.PI);break;case 4:b.translate(0,d),b.scale(1,-1);break;case 5:a.width=d,a.height=c,b.rotate(.5*Math.PI),b.scale(1,-1);break;case 6:a.width=d,a.height=c,b.rotate(.5*Math.PI),b.translate(0,-d);break;case 7:a.width=d,a.height=c,b.rotate(.5*Math.PI),b.translate(c,-d),b.scale(-1,1);break;case 8:a.width=d,a.height=c,b.rotate(-.5*Math.PI),b.translate(-c,0)}},this.loadImageURI=function(a,b){var c=new Image;c.onload=function(){b(null,c)},c.onerror=function(a){b(a)},c.src=a}}]),angular.module("dashboard.services.Location",["dashboard.Config","dashboard.Utils"]).service("LocationService",["Config","Utils","$q","$rootScope",function(a,b,c,d){"ngInject";var e=c.defer();this.currentLocation=function(){return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){d.$apply(function(){e.resolve(a.coords)})},function(a){e.reject(a)}):e.reject("location services not allowed"),e.promise}}]),angular.module("dashboard.services.Session",["dashboard.Utils","dashboard.services.User","ngCookies"]).service("SessionService",["$cookies","$cookieStore","$q","UserService","Config","Utils","DashboardService",function(a,b,c,d,e,f,g){"ngInject";var h=this,i=null;this.logIn=function(b,d,e){var g="Users";return config.authModel&&(g=config.authModel),f.apiHelper("POST",g+"/login?include=user",{email:b,password:d,options:e}).then(function(a){return h.setSession(a)}).catch(function(){return a.put("session",null),c.reject(arguments)})},this.logOut=function(){var c="Users";config.authModel&&(c=config.authModel);var d=a.get("accessToken");return b.remove("username"),b.remove("userId"),b.remove("accessToken"),b.remove("roles"),b.remove("session"),b.remove("lastActive"),f.apiHelper("POST",c+"/logout?access_token="+d)},this.setSession=function(b){var d="Users";return config.authModel&&(d=config.authModel),f.apiHelper("GET",d+"/"+b.userId+"/Roles?access_token="+b.id).then(function(c){return a.put("lastActive",new Date),i=b,a.put("username",b.user.username),a.put("userId",b.userId),a.put("accessToken",b.id),a.put("session",JSON.stringify(i)),a.put("roles",JSON.stringify(c)),b}).catch(function(){return a.put("session",null),c.reject(arguments)})},this.getAuthToken=function(){return i&&i.id},this.put=function(b,c){var d=JSON.parse(a.get("session"));d[b]=c,a.put("session",JSON.stringify(d))},this.get=function(b){return JSON.parse(a.get("session"))[b]},this.isAuthorized=function(b,c){if(_.startsWith(b.name,"public"))return!0;var d=g.getNavigation(),e=b.name,f=c.model,h=c.action,i=angular.fromJson(a.get("roles"));if(_.isEmpty(f)){var j=_.find(d,{state:e});if(j)return g.hasAccess(i,j)}else{var j=_.find(d,{path:f});if(j){if(!g.hasAccess(i,j))return!1;if(_.isArray(j.subnav)&&!_.isEmpty(h)){var k=_.find(j.subnav,{label:h});if(k)return g.hasAccess(i,k)}}}var l=b.data.roles;return!(!_.isEmpty(l)&&_.isArray(l))||g.hasAccess(i,{roles:l})},function(){var b=a.get("session");b&&(i=JSON.parse(b))}()}]),angular.module("dashboard.services.Settings",["dashboard.Config","dashboard.Utils","ngCookies"]).service("SettingsService",["$cookies","Config","Utils",function(a,b,c){"ngInject";this.saveNav=function(d){var e=b.serverParams.cmsBaseUrl+"/settings/config/nav?access_token="+a.get("accessToken");return c.apiHelper("POST",e,d)}}]),angular.module("dashboard.services.User",["dashboard.Config","dashboard.Utils"]).service("UserService",["Config","Utils","$q","$rootScope",function(a,b,c,d){"ngInject";this.register=function(a,c){var d="Users";return config.authModel&&(d=config.authModel),b.apiHelper("POST",d,{email:a,password:c})}}]),angular.module("dashboard.Utils",["dashboard.Config"]).service("Utils",["Config","$http","$q",function(a,b,c){"ngInject";var d={};this.apiCancel=function(a,b){var c=d[a+":"+b];c&&c.resolve&&c.resolve(),delete d[a+":"+b]},this.apiHelper=function(e,f,g,h){var i=c.defer();return h=h||{},h.method=e,"/"==f[0]?h.url=f:(a.apiBaseUrl&&"/"!=a.apiBaseUrl[a.apiBaseUrl.length-1]&&"/"!=f[f.length-1]&&(a.apiBaseUrl+="/"),h.url=a.apiBaseUrl+f),"POST"==e||"PUT"==e?h.data=g:h.params=g,d[e+":"+f]=i,h.timeout=i.promise,b(h).then(function(a){i.resolve(a.data)},function(a){i.reject(a.data)}),i.promise}}]),$.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},window,window.angular;
//# sourceMappingURL=app.js.map